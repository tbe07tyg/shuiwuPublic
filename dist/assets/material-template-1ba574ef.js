import{M as me,m as c}from"./MaterialTemplateSync-4cbe366a.js";import{_ as ue}from"./index-053c0381.js";import{F as pe,t as ge,J as _e,a0 as ve,ah as fe,R as ye,d as he,f as Ce,K as be,w as Oe,x as we,H as ke,$ as Fe,a6 as xe,m as y,W as se}from"./antd-19bac614.js";import{f as d,r as Te,c as Se,o as Re,S as l,U as f,V as x,W as n,k as o,G as m,X as s,Z as r,F as ie,Y as Be,_ as E,a0 as R}from"./vendor-e4b530e5.js";const Ne={name:"MaterialTemplateManager",components:{FileTextOutlined:pe,UploadOutlined:ge,DownloadOutlined:_e,ReloadOutlined:ve,FormOutlined:fe,RocketOutlined:ye,PieChartOutlined:he,CheckCircleOutlined:Ce,PlusOutlined:be,EditOutlined:Oe,DeleteOutlined:we,FileOutlined:ke,EyeOutlined:Fe,InboxOutlined:xe,MaterialTemplateSync:me},setup(){const u=d("apply"),t=d(!1),z=d(!1),e=d(!1),B=d(!1),w=d(""),k=d(!1),N=d(!1),p=d(!1),q=d("apply"),T={apply:"立项申请",opening:"项目开题",midterm:"项目中期",acceptance:"项目验收"},_=Te({id:null,categoryName:"",isRequired:!0,sortOrder:1,description:"",templateFileName:"",templateFilePath:""}),b=d([]),h=d([]),I=d(!1),U=d(!1),M={categoryName:[{required:!0,message:"请输入类目名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],sortOrder:[{required:!0,message:"请输入显示顺序",trigger:"blur"}]},j=[{title:"序号",dataIndex:"sortOrder",key:"sortOrder",width:80,align:"center",sorter:(a,g)=>a.sortOrder-g.sortOrder},{title:"类目名称",dataIndex:"categoryName",key:"categoryName",width:200},{title:"必传项",dataIndex:"isRequired",key:"isRequired",width:100,align:"center"},{title:"模板文件",dataIndex:"templateFileName",key:"templateFileName",width:250},{title:"描述说明",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",key:"action",width:180,align:"center"}],K={pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(a,g)=>`共 ${a} 条记录，当前显示 ${g[0]}-${g[1]} 条`},J=Se(()=>B.value?"编辑资料类目":"添加资料类目"),W=a=>c.getConfigsByBusinessType(a).length,A=a=>c.getConfigsByBusinessType(a).filter(v=>v.isRequired).length,G=a=>c.getConfigsByBusinessType(a).filter(v=>!v.isRequired).length,H=a=>{const g=c.getConfigsByBusinessType(a);return w.value?g.filter(v=>v.categoryName.toLowerCase().includes(w.value.toLowerCase())||v.description&&v.description.toLowerCase().includes(w.value.toLowerCase())).sort((v,le)=>(v.sortOrder||0)-(le.sortOrder||0)):g.sort((v,le)=>(v.sortOrder||0)-(le.sortOrder||0))},Q=async()=>{k.value=!0;try{await c.initConfigs(),y.success("配置刷新成功")}catch{y.error("配置刷新失败")}finally{k.value=!1}},X=a=>{u.value=a},F=a=>{u.value=a,w.value=""},L=a=>{w.value=a},Y=()=>{B.value=!1,S(),t.value=!0},Z=a=>{B.value=!0,Object.assign(_,a),a.templateFileName?b.value=[{uid:"1",name:a.templateFileName,status:"done"}]:b.value=[],t.value=!0},$=async a=>{se.confirm({title:"确认删除",content:`确定要删除类目"${a.categoryName}"吗？删除后将无法恢复，请谨慎操作！`,okText:"确定删除",cancelText:"取消",okType:"danger",async onOk(){try{await c.deleteConfig(u.value,a.id)}catch{}}})},ee=async()=>{N.value=!0;try{const a={..._};B.value?await c.updateConfig(u.value,a.id,a):await c.addConfig(u.value,a),t.value=!1,S()}catch{}finally{N.value=!1}},S=()=>{const a=c.getConfigsByBusinessType(u.value);Object.assign(_,{id:null,categoryName:"",isRequired:!0,sortOrder:a.length+1,description:"",templateFileName:"",templateFilePath:""}),b.value=[]},te=()=>{S()},D=a=>a.size>10485760?(y.error("文件大小不能超过10MB"),!1):(I.value=!0,setTimeout(()=>{_.templateFileName=a.name,_.templateFilePath=`/templates/${u.value}/${a.name}`,b.value=[{uid:a.uid||Date.now().toString(),name:a.name,status:"done",url:_.templateFilePath,originFileObj:a}],I.value=!1,y.success(`模板文件 "${a.name}" 已选择`)},200),!1),ae=a=>(_.templateFileName="",_.templateFilePath="",b.value=[],y.success("模板文件已移除"),!0),oe=a=>{y.info(`正在下载模板：${a.templateFileName}`)},ne=a=>{q.value=a,z.value=!0},i=a=>{console.log("预览页面配置已更新",a)},P=()=>{e.value=!0},O=()=>{h.value=[]},C=a=>a.name.endsWith(".json")?(U.value=!0,setTimeout(()=>{h.value=[{uid:a.uid||Date.now().toString(),name:a.name,status:"done",originFileObj:a}],U.value=!1,y.success(`配置文件 "${a.name}" 已选择`)},200),!1):(y.error("请选择JSON格式的配置文件"),!1),V=a=>(h.value=[],y.success("导入文件已移除"),!0),re=async()=>{if(h.value.length===0){y.warning("请先选择要导入的配置文件");return}p.value=!0;try{const a=h.value[0].originFileObj;await c.importConfigs(a,u.value),e.value=!1,h.value=[]}catch{}finally{p.value=!1}},de=()=>{c.exportConfigs(u.value)},ce=()=>{se.confirm({title:"确认重置",content:"确定要重置为默认配置吗？当前所有自定义配置将被清空，此操作无法撤销！",okText:"确定重置",cancelText:"取消",okType:"danger",async onOk(){await c.resetToDefault(u.value)}})};return Re(async()=>{k.value=!0;try{await c.initConfigs()}finally{k.value=!1}}),{activeTab:u,dialogVisible:t,previewVisible:z,importVisible:e,categoryForm:_,categoryRules:M,searchKeyword:w,columns:j,loading:k,submitLoading:N,importLoading:p,businessTabs:T,templateFileList:b,importFileList:h,templateUploading:I,importUploading:U,paginationConfig:K,previewBusinessType:q,dialogTitle:J,getBusinessStats:W,getRequiredStats:A,getOptionalStats:G,getFilteredConfigs:H,handleRefreshConfigs:Q,handleStatCardClick:X,handleTabChange:F,handleSearch:L,handleAddCategory:Y,handleEditCategory:Z,handleDeleteCategory:$,handleSaveCategory:ee,handleDialogClose:te,resetCategoryForm:S,handleTemplateUpload:D,handleRemoveTemplate:ae,handleDownloadTemplate:oe,handlePreviewBusinessPage:ne,handlePreviewConfigUpdate:i,handleBatchImport:P,handleImportDialogClose:O,handleImportFile:C,handleRemoveImportFile:V,handleConfirmImport:re,handleBatchExport:de,handleResetToDefault:ce}}},Ie={class:"material-template-manager"},Ue={class:"page-header"},De={class:"header-content"},Pe={class:"page-title"},qe={class:"title-icon"},Le={class:"header-actions"},Ve={class:"stats-overview"},Ee={class:"stat-icon"},ze={class:"stat-content"},Me={class:"stat-number"},je={class:"stat-detail"},Ke={class:"stat-icon"},Je={class:"stat-content"},We={class:"stat-number"},Ae={class:"stat-detail"},Ge={class:"stat-icon"},He={class:"stat-content"},Qe={class:"stat-number"},Xe={class:"stat-detail"},Ye={class:"stat-icon"},Ze={class:"stat-content"},$e={class:"stat-number"},et={class:"stat-detail"},tt={class:"content-card"},at={class:"tab-content"},ot={class:"toolbar"},nt={class:"toolbar-left"},lt={class:"toolbar-right"},st={key:0,class:"template-file"},it={key:1,class:"no-template"},rt={key:2,class:"action-buttons"},dt={class:"upload-tips"},ct={key:0,class:"upload-success"},mt={class:"ant-upload-drag-icon"},ut={class:"ant-upload-text"},pt={class:"ant-upload-hint"};function gt(u,t,z,e,B,w){const k=l("FileTextOutlined"),N=l("ReloadOutlined"),p=l("a-button"),q=l("FormOutlined"),T=l("a-col"),_=l("RocketOutlined"),b=l("PieChartOutlined"),h=l("CheckCircleOutlined"),I=l("a-row"),U=l("PlusOutlined"),M=l("EyeOutlined"),j=l("a-input-search"),K=l("a-tag"),J=l("FileOutlined"),W=l("EditOutlined"),A=l("DeleteOutlined"),G=l("a-table"),H=l("a-tab-pane"),Q=l("a-tabs"),X=l("a-input"),F=l("a-form-item"),L=l("a-radio"),Y=l("a-radio-group"),Z=l("a-input-number"),$=l("UploadOutlined"),ee=l("a-upload"),S=l("a-textarea"),te=l("a-form"),D=l("a-modal"),ae=l("MaterialTemplateSync"),oe=l("InboxOutlined"),ne=l("a-upload-dragger");return f(),x("div",Ie,[n("div",Ue,[n("div",De,[n("h1",Pe,[n("span",qe,[o(k)]),t[13]||(t[13]=m(" 材料提交模板维护 ",-1))]),t[14]||(t[14]=n("p",{class:"page-description"}," 统一管理各业务环节的资料类目和模板文件，实现配置的集中维护和实时同步 ",-1))]),n("div",Le,[o(p,{onClick:e.handleRefreshConfigs,loading:e.loading},{default:s(()=>[o(N),t[15]||(t[15]=m(" 刷新配置 ",-1))]),_:1,__:[15]},8,["onClick","loading"]),o(p,{type:"primary",danger:"",onClick:e.handleResetToDefault},{default:s(()=>t[16]||(t[16]=[m(" 重置默认 ",-1)])),_:1,__:[16]},8,["onClick"])])]),n("div",Ve,[o(I,{gutter:16},{default:s(()=>[o(T,{xs:12,sm:8,md:6,lg:6,xl:6},{default:s(()=>[n("div",{class:"stat-card pending",onClick:t[0]||(t[0]=i=>e.handleStatCardClick("apply"))},[n("div",Ee,[o(q)]),n("div",ze,[n("div",Me,r(e.getBusinessStats("apply")),1),t[17]||(t[17]=n("div",{class:"stat-label"},"立项申请类目",-1)),n("div",je,"必传"+r(e.getRequiredStats("apply"))+" | 选传"+r(e.getOptionalStats("apply")),1)])])]),_:1}),o(T,{xs:12,sm:8,md:6,lg:6,xl:6},{default:s(()=>[n("div",{class:"stat-card reviewing",onClick:t[1]||(t[1]=i=>e.handleStatCardClick("opening"))},[n("div",Ke,[o(_)]),n("div",Je,[n("div",We,r(e.getBusinessStats("opening")),1),t[18]||(t[18]=n("div",{class:"stat-label"},"项目开题类目",-1)),n("div",Ae,"必传"+r(e.getRequiredStats("opening"))+" | 选传"+r(e.getOptionalStats("opening")),1)])])]),_:1}),o(T,{xs:12,sm:8,md:6,lg:6,xl:6},{default:s(()=>[n("div",{class:"stat-card scheduled",onClick:t[2]||(t[2]=i=>e.handleStatCardClick("midterm"))},[n("div",Ge,[o(b)]),n("div",He,[n("div",Qe,r(e.getBusinessStats("midterm")),1),t[19]||(t[19]=n("div",{class:"stat-label"},"项目中期类目",-1)),n("div",Xe,"必传"+r(e.getRequiredStats("midterm"))+" | 选传"+r(e.getOptionalStats("midterm")),1)])])]),_:1}),o(T,{xs:12,sm:8,md:6,lg:6,xl:6},{default:s(()=>[n("div",{class:"stat-card completed",onClick:t[3]||(t[3]=i=>e.handleStatCardClick("acceptance"))},[n("div",Ye,[o(h)]),n("div",Ze,[n("div",$e,r(e.getBusinessStats("acceptance")),1),t[20]||(t[20]=n("div",{class:"stat-label"},"项目验收类目",-1)),n("div",et,"必传"+r(e.getRequiredStats("acceptance"))+" | 选传"+r(e.getOptionalStats("acceptance")),1)])])]),_:1})]),_:1})]),n("div",tt,[o(Q,{activeKey:e.activeTab,"onUpdate:activeKey":t[5]||(t[5]=i=>e.activeTab=i),onChange:e.handleTabChange,class:"custom-tabs",type:"card"},{default:s(()=>[(f(!0),x(ie,null,Be(e.businessTabs,(i,P)=>(f(),E(H,{key:P,tab:i},{default:s(()=>[n("div",at,[n("div",ot,[n("div",nt,[o(p,{type:"primary",onClick:e.handleAddCategory},{default:s(()=>[o(U),t[21]||(t[21]=m(" 添加新类目 ",-1))]),_:1,__:[21]},8,["onClick"]),o(p,{onClick:O=>e.handlePreviewBusinessPage(P)},{default:s(()=>[o(M),t[22]||(t[22]=m(" 预览效果 ",-1))]),_:2,__:[22]},1032,["onClick"])]),n("div",lt,[o(j,{value:e.searchKeyword,"onUpdate:value":t[4]||(t[4]=O=>e.searchKeyword=O),placeholder:"搜索类目名称",style:{width:"200px"},onSearch:e.handleSearch},null,8,["value","onSearch"])])]),o(G,{columns:e.columns,"data-source":e.getFilteredConfigs(P),pagination:e.paginationConfig,"row-key":"id",size:"middle",loading:e.loading},{bodyCell:s(({column:O,record:C})=>[O.key==="isRequired"?(f(),E(K,{key:0,color:C.isRequired?"red":"blue",size:"small"},{default:s(()=>[m(r(C.isRequired?"必传":"选传"),1)]),_:2},1032,["color"])):R("",!0),O.key==="templateFileName"?(f(),x(ie,{key:1},[C.templateFileName?(f(),x("div",st,[o(J),n("span",null,r(C.templateFileName),1),o(p,{type:"link",size:"small",onClick:V=>e.handleDownloadTemplate(C)},{default:s(()=>t[23]||(t[23]=[m(" 下载 ",-1)])),_:2,__:[23]},1032,["onClick"])])):(f(),x("span",it,"暂无模板"))],64)):R("",!0),O.key==="action"?(f(),x("div",rt,[o(p,{type:"primary",size:"small",onClick:V=>e.handleEditCategory(C)},{default:s(()=>[o(W),t[24]||(t[24]=m(" 编辑 ",-1))]),_:2,__:[24]},1032,["onClick"]),o(p,{danger:"",size:"small",onClick:V=>e.handleDeleteCategory(C)},{default:s(()=>[o(A),t[25]||(t[25]=m(" 删除 ",-1))]),_:2,__:[25]},1032,["onClick"])])):R("",!0)]),_:2},1032,["columns","data-source","pagination","loading"])])]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey","onChange"])]),o(D,{open:e.dialogVisible,"onUpdate:open":t[10]||(t[10]=i=>e.dialogVisible=i),title:e.dialogTitle,width:"700px",onCancel:e.handleDialogClose,onOk:e.handleSaveCategory,"confirm-loading":e.submitLoading},{default:s(()=>[o(te,{ref:"categoryFormRef",model:e.categoryForm,rules:e.categoryRules,"label-col":{span:6},"wrapper-col":{span:18}},{default:s(()=>[o(F,{label:"类目名称",name:"categoryName"},{default:s(()=>[o(X,{value:e.categoryForm.categoryName,"onUpdate:value":t[6]||(t[6]=i=>e.categoryForm.categoryName=i),placeholder:"请输入类目名称，如：项目申请书","allow-clear":""},null,8,["value"])]),_:1}),o(F,{label:"是否必传",name:"isRequired"},{default:s(()=>[o(Y,{value:e.categoryForm.isRequired,"onUpdate:value":t[7]||(t[7]=i=>e.categoryForm.isRequired=i)},{default:s(()=>[o(L,{value:!0},{default:s(()=>t[26]||(t[26]=[m("必传",-1)])),_:1,__:[26]}),o(L,{value:!1},{default:s(()=>t[27]||(t[27]=[m("选传",-1)])),_:1,__:[27]})]),_:1},8,["value"])]),_:1}),o(F,{label:"显示顺序",name:"sortOrder"},{default:s(()=>[o(Z,{value:e.categoryForm.sortOrder,"onUpdate:value":t[8]||(t[8]=i=>e.categoryForm.sortOrder=i),min:1,max:100,style:{width:"100%"},placeholder:"数字越小排序越靠前"},null,8,["value"])]),_:1}),o(F,{label:"模板文件"},{default:s(()=>[o(ee,{"file-list":e.templateFileList,"before-upload":e.handleTemplateUpload,remove:e.handleRemoveTemplate,accept:".doc,.docx,.pdf,.xls,.xlsx","max-count":1,"show-upload-list":{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!0}},{default:s(()=>[o(p,{loading:e.templateUploading},{default:s(()=>[e.templateUploading?R("",!0):(f(),E($,{key:0})),m(" "+r(e.templateUploading?"处理中...":e.templateFileList.length>0?"重新选择":"选择模板文件"),1)]),_:1},8,["loading"])]),_:1},8,["file-list","before-upload","remove"]),n("div",dt,[t[28]||(t[28]=m(" 支持 Word、Excel、PDF 格式，文件大小不超过10MB ",-1)),e.templateFileList.length>0?(f(),x("span",ct," ✓ 文件已选择："+r(e.templateFileList[0].name),1)):R("",!0)])]),_:1}),o(F,{label:"描述说明"},{default:s(()=>[o(S,{value:e.categoryForm.description,"onUpdate:value":t[9]||(t[9]=i=>e.categoryForm.description=i),rows:4,placeholder:"请输入对该类目的详细说明，用于帮助用户理解该材料的用途和要求...",maxlength:500,"show-count":""},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","title","onCancel","onOk","confirm-loading"]),o(D,{open:e.previewVisible,"onUpdate:open":t[11]||(t[11]=i=>e.previewVisible=i),title:`${e.businessTabs[e.previewBusinessType]}页面预览`,width:"90%",style:{top:"20px"},footer:null},{default:s(()=>[e.previewVisible?(f(),E(ae,{key:0,"business-type":e.previewBusinessType,"auto-load":!0,onConfigUpdate:e.handlePreviewConfigUpdate},null,8,["business-type","onConfigUpdate"])):R("",!0)]),_:1},8,["open","title"]),o(D,{open:e.importVisible,"onUpdate:open":t[12]||(t[12]=i=>e.importVisible=i),title:"批量导入配置",onOk:e.handleConfirmImport,onCancel:e.handleImportDialogClose,"confirm-loading":e.importLoading},{default:s(()=>[o(ne,{"file-list":e.importFileList,"before-upload":e.handleImportFile,remove:e.handleRemoveImportFile,accept:".json","max-count":1,"show-upload-list":{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!0}},{default:s(()=>[n("p",mt,[o(oe)]),n("p",ut,r(e.importFileList.length>0?"重新选择文件":"点击或拖拽文件到此区域上传"),1),n("p",pt,r(e.importFileList.length>0?`已选择：${e.importFileList[0].name}`:"支持导入JSON格式的配置文件"),1)]),_:1},8,["file-list","before-upload","remove"])]),_:1},8,["open","onOk","onCancel","confirm-loading"])])}const ht=ue(Ne,[["render",gt],["__scopeId","data-v-911ae0ce"]]);export{ht as default};

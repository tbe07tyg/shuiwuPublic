import{a4 as ee,f as c,c as k,o as te,S as i,U as R,V as U,W as o,Z as b,k as e,X as s,u as x,G as y,a0 as z}from"./vendor-e4b530e5.js";import{o as I,m as f,X as ae,F as se,E as re,Y as ne,Z as oe}from"./antd-19bac614.js";import{_ as le}from"./index-053c0381.js";const ie={class:"submit-container"},ue={class:"page-header"},de={class:"header-content"},me={class:"page-title"},ce={class:"page-description"},pe={class:"header-actions"},ve={class:"form-section"},_e={class:"section-header"},fe={class:"section-content"},ye={key:0,class:"form-section"},ge={class:"section-header"},qe={class:"review-comments-content"},be={class:"comments-text"},xe={class:"form-section"},he={key:0,class:"resubmit-notice"},ke={class:"form-actions"},we={__name:"submit",setup(Ce){const g=ee(),N=c(),V=c(),M=c({allRequiredUploaded:!1,uploadedCount:0,totalCount:0}),w=c([]),h=k(()=>g.currentRoute.value.query.resubmit==="true"),m=k(()=>g.currentRoute.value.query.improvement==="true"),O=k(()=>m.value?"提交整改材料":h.value?"重新提交立项申请":"提交立项申请"),F=k(()=>m.value?"根据立项会议的整改要求，提交相应的整改材料和说明":h.value?"根据审核意见修改完善后重新提交立项申请":"填写项目立项申请信息并上传相关材料"),r=c({year:"2024",projectName:"",applicant:"",department:"",duration:void 0,budget:void 0,expectedDate:void 0,description:"",remarks:""}),B={year:[{required:!0,message:"请选择年度"}],projectName:[{required:!0,message:"请输入立项名称"}],applicant:[{required:!0,message:"请输入申请人姓名"}],department:[{required:!0,message:"请输入申请单位"}],duration:[{required:!0,message:"请输入项目周期"}],budget:[{required:!0,message:"请输入项目预算"}],expectedDate:[{required:!0,message:"请选择预期立项时间"}],description:[{required:!0,message:"请填写申请说明"}]},j=c([{key:"acceptance_report",name:"项目立项报告",description:"详细的项目立项报告，包含项目完成情况、技术指标等",fileList:[]},{key:"summary_report",name:"项目总结报告",description:"项目实施过程总结，包含经验教训、改进建议等",fileList:[]},{key:"achievement_materials",name:"成果汇总材料",description:"项目产出的各类成果材料，如软件、报告、专利等",fileList:[]},{key:"financial_report",name:"财务决算报告",description:"项目资金使用情况的详细财务报告",fileList:[]}]),E=c([{key:"ip_list",name:"知识产权清单",description:"项目产生的专利、软著等知识产权清单",fileList:[]},{key:"test_report",name:"测试报告",description:"系统测试、性能测试等相关测试报告",fileList:[]},{key:"user_manual",name:"用户手册",description:"系统使用手册、操作指南等文档",fileList:[]},{key:"other_materials",name:"其他材料",description:"其他与项目立项相关的补充材料",fileList:[]}]),T=c(!1),q=c("");c(!1),c({});const X=a=>a&&a<I().startOf("day"),Z=()=>{g.go(-1)},A=async()=>{try{f.success("草稿保存成功")}catch{f.error("草稿保存失败")}},G=async a=>{try{T.value=!0;const t=j.value.filter(u=>u.fileList.length===0);if(t.length>0){f.error(`请上传必需材料：${t.map(u=>u.name).join("、")}`);return}const p=g.currentRoute.value,v=p.query.resubmit==="true",l=p.query.improvement==="true",_={...a,materials:{required:j.value.reduce((u,d)=>(u[d.key]=d.fileList,u),{}),optional:E.value.reduce((u,d)=>(u[d.key]=d.fileList,u),{})},statusUpdate:v?{from:"material_rejected",to:"material_reviewing",reason:"用户重新提交材料，状态自动变更为材料审核中"}:null,submitType:v?"resubmit":l?"improvement":"normal",projectId:p.query.projectId?parseInt(p.query.projectId):a.projectId};console.log("Submit data:",_),console.log("Submit type:",_.submitType),_.statusUpdate&&console.log("Status will be updated:",_.statusUpdate),await new Promise(u=>setTimeout(u,2e3)),v?f.success("材料重新提交成功，状态已更新为材料审核中"):l?f.success("整改材料提交成功"):f.success("立项申请提交成功"),g.push("/th_qd/approval/applicant/manage")}catch{f.error("提交失败，请重试")}finally{T.value=!1}},P=a=>{const{configId:t,file:p,action:v}=a;if(v==="add")w.value.push({configId:t,file:p});else if(v==="remove"){const l=w.value.findIndex(_=>_.configId===t);l>-1&&w.value.splice(l,1)}},W=a=>{M.value=a},Y=a=>{console.log("立项材料配置已更新:",a)};return te(()=>{const a=g.currentRoute.value;a.query.resubmit==="true"&&(a.query.expectedTime&&(r.value.expectedDate=I(a.query.expectedTime)),a.query.description&&(r.value.description=decodeURIComponent(a.query.description)),a.query.rejectionReason?q.value=decodeURIComponent(a.query.rejectionReason):a.query.reviewComments&&(q.value=decodeURIComponent(a.query.reviewComments)),f.info("请重新上传立项材料并完善申请信息")),a.query.improvement==="true"&&(a.query.expectedTime&&(r.value.expectedDate=I(a.query.expectedTime)),a.query.description&&(r.value.description=decodeURIComponent(a.query.description)),a.query.improvementRequirements&&(q.value=decodeURIComponent(a.query.improvementRequirements)),f.info("请根据整改要求上传相关材料"))}),(a,t)=>{const p=i("a-button"),v=i("a-input"),l=i("a-form-item"),_=i("a-select-option"),u=i("a-select"),d=i("a-col"),C=i("a-row"),D=i("a-input-number"),$=i("a-date-picker"),S=i("a-textarea"),L=i("a-alert"),H=i("MaterialTemplateSync"),J=i("a-space"),K=i("a-form"),Q=i("a-card");return R(),U("div",ie,[o("div",ue,[o("div",de,[o("h1",me,b(O.value),1),o("p",ce,b(F.value),1)]),o("div",pe,[e(p,{onClick:Z},{default:s(()=>[e(x(ae)),t[9]||(t[9]=y(" 返回列表 ",-1))]),_:1,__:[9]})])]),e(Q,{bordered:!1},{default:s(()=>[e(K,{ref_key:"formRef",ref:N,model:r.value,rules:B,layout:"vertical",onFinish:G},{default:s(()=>[o("div",ve,[o("div",_e,[o("h3",null,[e(x(se)),t[10]||(t[10]=y(" 申请信息 ",-1))]),t[11]||(t[11]=o("p",null,"填写立项申请的基本信息",-1))]),o("div",fe,[e(l,{label:"立项名称",name:"projectName",rules:[{required:!0,message:"请输入立项名称"}]},{default:s(()=>[e(v,{value:r.value.projectName,"onUpdate:value":t[0]||(t[0]=n=>r.value.projectName=n),placeholder:"请输入立项名称",size:"large"},null,8,["value"])]),_:1}),e(C,{gutter:24},{default:s(()=>[e(d,{xs:24,md:12},{default:s(()=>[e(l,{label:"年度",name:"year",rules:[{required:!0,message:"请选择年度"}]},{default:s(()=>[e(u,{value:r.value.year,"onUpdate:value":t[1]||(t[1]=n=>r.value.year=n),placeholder:"请选择年度",size:"large"},{default:s(()=>[e(_,{value:"2024"},{default:s(()=>t[12]||(t[12]=[y("2024",-1)])),_:1,__:[12]}),e(_,{value:"2025"},{default:s(()=>t[13]||(t[13]=[y("2025",-1)])),_:1,__:[13]})]),_:1},8,["value"])]),_:1})]),_:1}),e(d,{xs:24,md:12},{default:s(()=>[e(l,{label:"申请人",name:"applicant",rules:[{required:!0,message:"请输入申请人姓名"}]},{default:s(()=>[e(v,{value:r.value.applicant,"onUpdate:value":t[2]||(t[2]=n=>r.value.applicant=n),placeholder:"请输入申请人姓名",size:"large"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(C,{gutter:24},{default:s(()=>[e(d,{xs:24,md:12},{default:s(()=>[e(l,{label:"申请单位",name:"department",rules:[{required:!0,message:"请输入申请单位"}]},{default:s(()=>[e(v,{value:r.value.department,"onUpdate:value":t[3]||(t[3]=n=>r.value.department=n),placeholder:"请输入申请单位",size:"large"},null,8,["value"])]),_:1})]),_:1}),e(d,{xs:24,md:12},{default:s(()=>[e(l,{label:"项目周期(月)",name:"duration",rules:[{required:!0,message:"请输入项目周期"}]},{default:s(()=>[e(D,{value:r.value.duration,"onUpdate:value":t[4]||(t[4]=n=>r.value.duration=n),placeholder:"请输入项目周期",size:"large",min:1,max:60,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(C,{gutter:24},{default:s(()=>[e(d,{xs:24,md:12},{default:s(()=>[e(l,{label:"预算(万元)",name:"budget",rules:[{required:!0,message:"请输入项目预算"}]},{default:s(()=>[e(D,{value:r.value.budget,"onUpdate:value":t[5]||(t[5]=n=>r.value.budget=n),placeholder:"请输入项目预算",size:"large",min:0,precision:2,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(d,{xs:24,md:12},{default:s(()=>[e(l,{label:"预期立项时间",name:"expectedDate",rules:[{required:!0,message:"请选择预期立项时间"}]},{default:s(()=>[e($,{value:r.value.expectedDate,"onUpdate:value":t[6]||(t[6]=n=>r.value.expectedDate=n),placeholder:"请选择预期立项时间",size:"large",style:{width:"100%"},"disabled-date":X},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(l,{label:"申请说明",name:"description",rules:[{required:!0,message:"请填写申请说明"}]},{default:s(()=>[e(S,{value:r.value.description,"onUpdate:value":t[7]||(t[7]=n=>r.value.description=n),placeholder:"请详细说明项目完成情况、主要成果及立项准备情况",rows:4,size:"large","show-count":"",maxlength:500},null,8,["value"])]),_:1}),e(l,{label:"备注说明",name:"remarks"},{default:s(()=>[e(S,{value:r.value.remarks,"onUpdate:value":t[8]||(t[8]=n=>r.value.remarks=n),placeholder:"其他需要说明的事项（选填）",rows:3,size:"large","show-count":"",maxlength:200},null,8,["value"])]),_:1})])]),(h.value||m.value)&&q.value?(R(),U("div",ye,[o("div",ge,[o("h3",null,[e(x(re)),y(" "+b(m.value?"整改要求":"审核意见"),1)]),o("p",null,"请仔细阅读以下"+b(m.value?"整改要求":"审核意见")+"，并据此修改完善申请材料",1)]),o("div",qe,[e(L,{message:m.value?"立项会议整改要求":"材料审核意见",type:m.value?"warning":"error","show-icon":""},{description:s(()=>[o("div",be,b(q.value),1)]),_:1},8,["message","type"])])])):z("",!0),o("div",xe,[h.value||m.value?(R(),U("div",he,[e(L,{message:m.value?"整改材料提交":"重新提交提醒",description:m.value?"请根据立项会议的整改要求，上传相应的整改材料和说明文档。":"由于材料审核未通过，请根据审核意见重新准备并上传所有必需材料。",type:m.value?"warning":"info","show-icon":"",style:{"margin-bottom":"16px"}},null,8,["message","description","type"])])):z("",!0),e(H,{ref_key:"materialTemplateSyncRef",ref:V,"business-type":"apply",onFilesChange:P,onValidationChange:W,onConfigUpdate:Y},null,512)]),o("div",ke,[e(J,null,{default:s(()=>[e(p,{onClick:A},{default:s(()=>[e(x(ne)),t[14]||(t[14]=y(" 保存草稿 ",-1))]),_:1,__:[14]}),e(p,{type:"primary","html-type":"submit"},{default:s(()=>[e(x(oe)),t[15]||(t[15]=y(" 提交申请 ",-1))]),_:1,__:[15]})]),_:1})])]),_:1},8,["model"])]),_:1})])}}},je=le(we,[["__scopeId","data-v-2f0d5f5c"]]);export{je as default};

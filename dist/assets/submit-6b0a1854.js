import{a4 as re,f as _,c as k,o as le,S as u,U as q,V as C,W as o,Z as p,k as a,X as s,u as j,G as d,F as ie,Y as ue,a0 as D,_ as de}from"./vendor-e4b530e5.js";import{o as T,m as y,X as ce,P as pe,F as me,E as _e,Y as ve,Z as fe}from"./antd-19bac614.js";import{_ as ye}from"./index-053c0381.js";const ge={class:"submit-container"},be={class:"page-header"},he={class:"header-content"},qe={class:"page-title"},je={class:"page-description"},Ie={class:"header-actions"},xe={class:"form-section"},ke={class:"section-header"},Ce={class:"section-content"},we={class:"project-option"},Re={class:"project-name"},De={class:"project-info"},Te={class:"project-code"},Le={class:"project-status"},Ue={key:0,class:"selected-project-info"},Se={class:"form-section"},Oe={class:"section-header"},Pe={class:"section-content"},Me={key:0,class:"form-section"},Ve={class:"section-header"},Fe={class:"review-comments-content"},ze={class:"comments-text"},Be={class:"form-section"},Ne={key:0,class:"resubmit-notice"},Ee={class:"form-actions"},Je={__name:"submit",setup(Ae){const h=re(),M=_(),V=_(),F=_({allRequiredUploaded:!1,uploadedCount:0,totalCount:0}),R=_([]),w=k(()=>h.currentRoute.value.query.resubmit==="true"),v=k(()=>h.currentRoute.value.query.improvement==="true"),z=k(()=>v.value?"提交整改材料":w.value?"重新提交中期申请":"提交中期申请"),B=k(()=>v.value?"根据验收会议的整改要求，提交相应的整改材料和说明":w.value?"根据审核意见修改完善后重新提交验收申请":"填写项目验收申请信息并上传相关材料"),n=_({projectId:void 0,expectedDate:void 0,acceptanceType:void 0,description:"",remarks:""}),N={projectId:[{required:!0,message:"请选择项目"}],expectedDate:[{required:!0,message:"请选择预期验收时间"}],acceptanceType:[{required:!0,message:"请选择验收类型"}],description:[{required:!0,message:"请填写申请说明"}]},I=_([{id:1,name:"智慧城市大数据平台建设项目",code:"PROJ-2024-001",status:"实施中",startDate:"2023-06-01",endDate:"2024-05-31",leader:"张三",budget:500},{id:2,name:"区块链供应链金融平台",code:"PROJ-2024-002",status:"实施中",startDate:"2023-08-01",endDate:"2024-07-31",leader:"李四",budget:300},{id:3,name:"AI智能客服系统",code:"PROJ-2024-003",status:"即将结束",startDate:"2023-09-01",endDate:"2024-03-31",leader:"王五",budget:200}]),f=k(()=>I.value.find(t=>t.id===n.value.projectId)),L=_([{key:"acceptance_report",name:"项目验收报告",description:"详细的项目验收报告，包含项目完成情况、技术指标等",fileList:[]},{key:"summary_report",name:"项目总结报告",description:"项目实施过程总结，包含经验教训、改进建议等",fileList:[]},{key:"achievement_materials",name:"成果汇总材料",description:"项目产出的各类成果材料，如软件、报告、专利等",fileList:[]},{key:"financial_report",name:"财务决算报告",description:"项目资金使用情况的详细财务报告",fileList:[]}]),E=_([{key:"ip_list",name:"知识产权清单",description:"项目产生的专利、软著等知识产权清单",fileList:[]},{key:"test_report",name:"测试报告",description:"系统测试、性能测试等相关测试报告",fileList:[]},{key:"user_manual",name:"用户手册",description:"系统使用手册、操作指南等文档",fileList:[]},{key:"other_materials",name:"其他材料",description:"其他与项目验收相关的补充材料",fileList:[]}]),U=_(!1),x=_("");_(!1),_({});const J=t=>({实施中:"blue",即将结束:"orange",已完成:"green",暂停:"red"})[t]||"default",A=(t,e)=>{const i=I.value.find(l=>l.id===e.value);return i&&(i.name.toLowerCase().includes(t.toLowerCase())||i.code.toLowerCase().includes(t.toLowerCase()))},X=t=>t&&t<T().startOf("day"),Y=()=>{h.go(-1)},Z=t=>{console.log("Selected project:",t)},G=async()=>{try{y.success("草稿保存成功")}catch{y.error("草稿保存失败")}},W=async t=>{try{U.value=!0;const e=L.value.filter(r=>r.fileList.length===0);if(e.length>0){y.error(`请上传必需材料：${e.map(r=>r.name).join("、")}`);return}const i=h.currentRoute.value,l=i.query.resubmit==="true",g=i.query.improvement==="true",m={...t,materials:{required:L.value.reduce((r,b)=>(r[b.key]=b.fileList,r),{}),optional:E.value.reduce((r,b)=>(r[b.key]=b.fileList,r),{})},statusUpdate:l?{from:"material_rejected",to:"material_reviewing",reason:"用户重新提交材料，状态自动变更为材料审核中"}:null,submitType:l?"resubmit":g?"improvement":"normal",projectId:i.query.projectId?parseInt(i.query.projectId):t.projectId};console.log("Submit data:",m),console.log("Submit type:",m.submitType),m.statusUpdate&&console.log("Status will be updated:",m.statusUpdate),await new Promise(r=>setTimeout(r,2e3)),l?y.success("材料重新提交成功，状态已更新为材料审核中"):g?y.success("整改材料提交成功"):y.success("中期申请提交成功"),h.push("/th_qd/midterm/applicant/manage")}catch{y.error("提交失败，请重试")}finally{U.value=!1}},$=t=>{const{configId:e,file:i,action:l}=t;if(l==="add")R.value.push({configId:e,file:i});else if(l==="remove"){const g=R.value.findIndex(m=>m.configId===e);g>-1&&R.value.splice(g,1)}},H=t=>{F.value=t},K=t=>{console.log("中期材料配置已更新:",t)};return le(()=>{const t=h.currentRoute.value;if(t.query.resubmit==="true"){if(t.query.projectId){const e=parseInt(t.query.projectId);I.value.find(l=>l.id===e)&&(n.value.projectId=e)}t.query.expectedTime&&(n.value.expectedDate=T(t.query.expectedTime)),t.query.description&&(n.value.description=decodeURIComponent(t.query.description)),t.query.rejectionReason?x.value=decodeURIComponent(t.query.rejectionReason):t.query.reviewComments&&(x.value=decodeURIComponent(t.query.reviewComments)),n.value.acceptanceType="final",y.info("已自动填充项目信息，请重新上传验收材料并完善申请信息")}if(t.query.improvement==="true"){if(t.query.projectId){const e=parseInt(t.query.projectId);I.value.find(l=>l.id===e)&&(n.value.projectId=e)}t.query.expectedTime&&(n.value.expectedDate=T(t.query.expectedTime)),t.query.description&&(n.value.description=decodeURIComponent(t.query.description)),t.query.improvementRequirements&&(x.value=decodeURIComponent(t.query.improvementRequirements)),n.value.acceptanceType="final",y.info("已自动填充项目信息，请根据整改要求上传相关材料")}}),(t,e)=>{const i=u("a-button"),l=u("a-select-option"),g=u("a-select"),m=u("a-form-item"),r=u("a-descriptions-item"),b=u("a-tag"),Q=u("a-descriptions"),ee=u("a-date-picker"),S=u("a-col"),te=u("a-row"),O=u("a-textarea"),P=u("a-alert"),ae=u("MaterialTemplateSync"),se=u("a-space"),oe=u("a-form"),ne=u("a-card");return q(),C("div",ge,[o("div",be,[o("div",he,[o("h1",qe,p(z.value),1),o("p",je,p(B.value),1)]),o("div",Ie,[a(i,{onClick:Y},{default:s(()=>[a(j(ce)),e[5]||(e[5]=d(" 返回列表 ",-1))]),_:1,__:[5]})])]),a(ne,{bordered:!1},{default:s(()=>[a(oe,{ref_key:"formRef",ref:M,model:n.value,rules:N,layout:"vertical",onFinish:W},{default:s(()=>[o("div",xe,[o("div",ke,[o("h3",null,[a(j(pe)),e[6]||(e[6]=d(" 项目选择 ",-1))]),e[7]||(e[7]=o("p",null,"选择需要申请中期检查的项目",-1))]),o("div",Ce,[a(m,{label:"选择项目",name:"projectId",rules:[{required:!0,message:"请选择项目"}]},{default:s(()=>[a(g,{value:n.value.projectId,"onUpdate:value":e[0]||(e[0]=c=>n.value.projectId=c),placeholder:"请选择项目",size:"large","show-search":"","filter-option":A,onChange:Z},{default:s(()=>[(q(!0),C(ie,null,ue(I.value,c=>(q(),de(l,{key:c.id,value:c.id},{default:s(()=>[o("div",we,[o("div",Re,p(c.name),1),o("div",De,[o("span",Te,p(c.code),1),o("span",Le,p(c.status),1)])])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),f.value?(q(),C("div",Ue,[a(Q,{column:2,bordered:"",size:"small"},{default:s(()=>[a(r,{label:"项目名称",span:2},{default:s(()=>[d(p(f.value.name),1)]),_:1}),a(r,{label:"项目编号"},{default:s(()=>[d(p(f.value.code),1)]),_:1}),a(r,{label:"项目状态"},{default:s(()=>[a(b,{color:J(f.value.status)},{default:s(()=>[d(p(f.value.status),1)]),_:1},8,["color"])]),_:1}),a(r,{label:"开始时间"},{default:s(()=>[d(p(f.value.startDate),1)]),_:1}),a(r,{label:"计划结束时间"},{default:s(()=>[d(p(f.value.endDate),1)]),_:1}),a(r,{label:"项目负责人"},{default:s(()=>[d(p(f.value.leader),1)]),_:1}),a(r,{label:"项目总预算"},{default:s(()=>[d(p(f.value.budget)+"万元 ",1)]),_:1})]),_:1})])):D("",!0)])]),o("div",Se,[o("div",Oe,[o("h3",null,[a(j(me)),e[8]||(e[8]=d(" 申请信息 ",-1))]),e[9]||(e[9]=o("p",null,"填写中期申请的基本信息",-1))]),o("div",Pe,[a(te,{gutter:24},{default:s(()=>[a(S,{xs:24,md:12},{default:s(()=>[a(m,{label:"预期中期时间",name:"expectedDate",rules:[{required:!0,message:"请选择预期验收时间"}]},{default:s(()=>[a(ee,{value:n.value.expectedDate,"onUpdate:value":e[1]||(e[1]=c=>n.value.expectedDate=c),placeholder:"请选择预期验收时间",size:"large",style:{width:"100%"},"disabled-date":X},null,8,["value"])]),_:1})]),_:1}),a(S,{xs:24,md:12},{default:s(()=>[a(m,{label:"中期类型",name:"acceptanceType",rules:[{required:!0,message:"请选择验收类型"}]},{default:s(()=>[a(g,{value:n.value.acceptanceType,"onUpdate:value":e[2]||(e[2]=c=>n.value.acceptanceType=c),placeholder:"请选择验收类型",size:"large"},{default:s(()=>[a(l,{value:"regular"},{default:s(()=>e[10]||(e[10]=[d("常规中期",-1)])),_:1,__:[10]}),a(l,{value:"special"},{default:s(()=>e[11]||(e[11]=[d("专项中期",-1)])),_:1,__:[11]}),a(l,{value:"extended"},{default:s(()=>e[12]||(e[12]=[d("延期中期",-1)])),_:1,__:[12]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(m,{label:"申请说明",name:"description",rules:[{required:!0,message:"请填写申请说明"}]},{default:s(()=>[a(O,{value:n.value.description,"onUpdate:value":e[3]||(e[3]=c=>n.value.description=c),placeholder:"请详细说明项目进展情况、阶段性成果及中期检查准备情况",rows:4,size:"large","show-count":"",maxlength:500},null,8,["value"])]),_:1}),a(m,{label:"备注说明",name:"remarks"},{default:s(()=>[a(O,{value:n.value.remarks,"onUpdate:value":e[4]||(e[4]=c=>n.value.remarks=c),placeholder:"其他需要说明的事项（选填）",rows:3,size:"large","show-count":"",maxlength:200},null,8,["value"])]),_:1})])]),(w.value||v.value)&&x.value?(q(),C("div",Me,[o("div",Ve,[o("h3",null,[a(j(_e)),d(" "+p(v.value?"整改要求":"审核意见"),1)]),o("p",null,"请仔细阅读以下"+p(v.value?"整改要求":"审核意见")+"，并据此修改完善申请材料",1)]),o("div",Fe,[a(P,{message:v.value?"中期会议整改要求":"材料审核意见",type:v.value?"warning":"error","show-icon":""},{description:s(()=>[o("div",ze,p(x.value),1)]),_:1},8,["message","type"])])])):D("",!0),o("div",Be,[w.value||v.value?(q(),C("div",Ne,[a(P,{message:v.value?"整改材料提交":"重新提交提醒",description:v.value?"请根据中期会议的整改要求，上传相应的整改材料和说明文档。":"由于材料审核未通过，请根据审核意见重新准备并上传所有必需材料。",type:v.value?"warning":"info","show-icon":"",style:{"margin-bottom":"16px"}},null,8,["message","description","type"])])):D("",!0),a(ae,{ref_key:"materialTemplateSyncRef",ref:V,"business-type":"midterm",onFilesChange:$,onValidationChange:H,onConfigUpdate:K},null,512)]),o("div",Ee,[a(se,null,{default:s(()=>[a(i,{onClick:G},{default:s(()=>[a(j(ve)),e[13]||(e[13]=d(" 保存草稿 ",-1))]),_:1,__:[13]}),a(i,{type:"primary","html-type":"submit"},{default:s(()=>[a(j(fe)),e[14]||(e[14]=d(" 提交申请 ",-1))]),_:1,__:[14]})]),_:1})])]),_:1},8,["model"])]),_:1})])}}},Ge=ye(Je,[["__scopeId","data-v-26f023d6"]]);export{Ge as default};

import{f as M,c as X,w as me,S as p,U as r,V as L,k as t,W as a,X as l,G as d,Z as y,_ as k,a0 as W,u as ve,a4 as fe,a5 as _e,F as K,Y as Z}from"./vendor-9e962977.js";import{o as U,t as ye,m as V}from"./antd-3abeaf7b.js";import{_ as ue}from"./index-b9d63c8b.js";const je={class:"apply-step"},ke={key:0,class:"project-info-readonly"},ge={style:{"text-align":"right","margin-top":"12px"}},be={class:"form-section"},he={class:"form-row"},Se={class:"form-row"},we={class:"form-row"},De={class:"form-row"},xe={class:"form-row"},Ce={key:0,class:"form-actions"},Me={class:"form-section"},$e={class:"template-download"},Ye={class:"form-actions"},Pe={__name:"ApplyStep",props:{project:Object},emits:["submit"],setup(S,{emit:H}){var z,O,G,q,B,i,j,E,ne;const s=S,c=H,D=M(),m=M(!1),$=M(!1),F=M(!1),Y=M(!1),P=X(()=>{var o,e,w;return!((o=s.project)!=null&&o.name)||!((e=s.project)!=null&&e.leader)||!((w=s.project)!=null&&w.dept)}),A=X(()=>!0),n=M({name:((z=s.project)==null?void 0:z.name)||"",type:((O=s.project)==null?void 0:O.type)||"",leader:((G=s.project)==null?void 0:G.leader)||"",dept:((q=s.project)==null?void 0:q.dept)||"",startDate:(B=s.project)!=null&&B.start?U(s.project.start):null,endDate:(i=s.project)!=null&&i.end?U(s.project.end):null,budget:((E=(j=s.project)==null?void 0:j.fund)==null?void 0:E.total)||null,description:((ne=s.project)==null?void 0:ne.desc)||""}),x=[{label:"纵向课题",value:"纵向"},{label:"横向课题",value:"横向"},{label:"自筹项目",value:"自筹"}],T=M([]),J={name:[{required:!0,message:"请输入项目名称"}],type:[{required:!0,message:"请选择项目类型"}],leader:[{required:!0,message:"请输入项目负责人"}],dept:[{required:!0,message:"请输入所属部门"}],startDate:[{required:!0,message:"请选择计划开始时间"}],endDate:[{required:!0,message:"请选择计划结束时间"}],budget:[{required:!0,message:"请输入申请预算"}],description:[{required:!0,message:"请输入项目简介"}]};function b(){var o,e,w,f,R,h,C,_,I;Y.value=!0,n.value={name:((o=s.project)==null?void 0:o.name)||"",type:((e=s.project)==null?void 0:e.type)||"",leader:((w=s.project)==null?void 0:w.leader)||"",dept:((f=s.project)==null?void 0:f.dept)||"",startDate:(R=s.project)!=null&&R.start?U(s.project.start):null,endDate:(h=s.project)!=null&&h.end?U(s.project.end):null,budget:((_=(C=s.project)==null?void 0:C.fund)==null?void 0:_.total)||null,description:((I=s.project)==null?void 0:I.desc)||""}}function Q(){var o,e,w,f,R,h,C,_,I;Y.value=!1,n.value={name:((o=s.project)==null?void 0:o.name)||"",type:((e=s.project)==null?void 0:e.type)||"",leader:((w=s.project)==null?void 0:w.leader)||"",dept:((f=s.project)==null?void 0:f.dept)||"",startDate:(R=s.project)!=null&&R.start?U(s.project.start):null,endDate:(h=s.project)!=null&&h.end?U(s.project.end):null,budget:((_=(C=s.project)==null?void 0:C.fund)==null?void 0:_.total)||null,description:((I=s.project)==null?void 0:I.desc)||""}}function ee(){var o;(o=D.value)==null||o.validateFields().then(()=>{F.value=!0,setTimeout(()=>{F.value=!1,Y.value=!1,V.success("项目信息已更新")},1e3)})}function te(o){return["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"].includes(o.type)?(o.size/1024/1024<10||V.error("文件大小不能超过 10MB!"),!1):(V.error("只支持上传 PDF、Word、Excel、PPT 格式的文件!"),!1)}function ae({file:o,fileList:e}){T.value=e}function le(o){T.value=T.value.filter(e=>e.uid!==o.uid)}function N(o){V.info(`正在下载${o}模板...`)}function se(){$.value=!0,setTimeout(()=>{$.value=!1,V.success("草稿已保存")},1e3)}function v(){if(T.value.length===0){V.error("请至少上传一个申报文件");return}m.value=!0,setTimeout(()=>{m.value=!1,V.success("申报材料提交成功，已转入审核流程"),c("submit",{formData:n.value,files:T.value,action:"submit_materials"})},1500)}function g(){P.value&&v()}return me(()=>s.project,o=>{var e;o&&(n.value={name:o.name||"",type:o.type||"",leader:o.leader||"",dept:o.dept||"",startDate:o.start?U(o.start):null,endDate:o.end?U(o.end):null,budget:((e=o.fund)==null?void 0:e.total)||null,description:o.desc||""})},{immediate:!0}),(o,e)=>{const w=p("a-alert"),f=p("a-descriptions-item"),R=p("a-descriptions"),h=p("a-button"),C=p("a-input"),_=p("a-form-item"),I=p("a-select"),ie=p("a-input-number"),re=p("a-date-picker"),de=p("a-textarea"),oe=p("a-space"),pe=p("a-form"),ce=p("a-upload");return r(),L("div",je,[t(w,{message:P.value?"新建项目申报":"立项申报",description:P.value?"请填写项目基本信息并上传相关申报材料，完成后提交审核。":"项目基本信息已确定，请上传申报材料并提交审核。",type:"info","show-icon":"",style:{"margin-bottom":"24px"}},null,8,["message","description"]),P.value?W("",!0):(r(),L("div",ke,[e[12]||(e[12]=a("h4",{class:"section-title"},"项目基本信息",-1)),t(R,{column:2,bordered:""},{default:l(()=>[t(f,{label:"项目名称"},{default:l(()=>[d(y(S.project.name),1)]),_:1}),t(f,{label:"项目类型"},{default:l(()=>[d(y(S.project.type),1)]),_:1}),t(f,{label:"项目负责人"},{default:l(()=>[d(y(S.project.leader),1)]),_:1}),t(f,{label:"所属部门"},{default:l(()=>[d(y(S.project.dept),1)]),_:1}),t(f,{label:"计划开始时间"},{default:l(()=>[d(y(S.project.start),1)]),_:1}),t(f,{label:"计划结束时间"},{default:l(()=>[d(y(S.project.end),1)]),_:1}),t(f,{label:"申请预算"},{default:l(()=>{var u;return[d(y(((u=S.project.fund)==null?void 0:u.total)||"-")+"万元",1)]}),_:1}),t(f,{label:"项目状态"},{default:l(()=>[d(y(S.project.status),1)]),_:1}),t(f,{label:"项目简介",span:2},{default:l(()=>[d(y(S.project.desc),1)]),_:1})]),_:1}),a("div",ge,[A.value?(r(),k(h,{key:0,type:"link",onClick:b},{default:l(()=>e[11]||(e[11]=[d(" 编辑项目信息 ",-1)])),_:1,__:[11]})):W("",!0)])])),P.value||Y.value?(r(),k(pe,{key:1,model:n.value,rules:J,onFinish:g,ref_key:"formRef",ref:D,layout:"horizontal"},{default:l(()=>[a("div",be,[e[13]||(e[13]=a("h4",{class:"section-title"},"项目基本信息",-1)),a("div",he,[t(_,{label:"项目名称",name:"name",class:"form-item-full"},{default:l(()=>[t(C,{value:n.value.name,"onUpdate:value":e[0]||(e[0]=u=>n.value.name=u),placeholder:"请输入项目名称"},null,8,["value"])]),_:1})]),a("div",Se,[t(_,{label:"项目类型",name:"type",class:"form-item-half"},{default:l(()=>[t(I,{value:n.value.type,"onUpdate:value":e[1]||(e[1]=u=>n.value.type=u),options:x,placeholder:"请选择项目类型"},null,8,["value"])]),_:1}),t(_,{label:"项目负责人",name:"leader",class:"form-item-half"},{default:l(()=>[t(C,{value:n.value.leader,"onUpdate:value":e[2]||(e[2]=u=>n.value.leader=u),placeholder:"请输入负责人姓名"},null,8,["value"])]),_:1})]),a("div",we,[t(_,{label:"所属部门",name:"dept",class:"form-item-half"},{default:l(()=>[t(C,{value:n.value.dept,"onUpdate:value":e[3]||(e[3]=u=>n.value.dept=u),placeholder:"请输入所属部门"},null,8,["value"])]),_:1}),t(_,{label:"申请预算",name:"budget",class:"form-item-half"},{default:l(()=>[t(ie,{value:n.value.budget,"onUpdate:value":e[4]||(e[4]=u=>n.value.budget=u),min:0,precision:2,style:{width:"100%"},placeholder:"请输入申请预算（万元）","addon-after":"万元"},null,8,["value"])]),_:1})]),a("div",De,[t(_,{label:"计划开始时间",name:"startDate",class:"form-item-half"},{default:l(()=>[t(re,{value:n.value.startDate,"onUpdate:value":e[5]||(e[5]=u=>n.value.startDate=u),placeholder:"请选择开始时间",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["value"])]),_:1}),t(_,{label:"计划结束时间",name:"endDate",class:"form-item-half"},{default:l(()=>[t(re,{value:n.value.endDate,"onUpdate:value":e[6]||(e[6]=u=>n.value.endDate=u),placeholder:"请选择结束时间",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["value"])]),_:1})]),a("div",xe,[t(_,{label:"项目简介",name:"description",class:"form-item-full"},{default:l(()=>[t(de,{value:n.value.description,"onUpdate:value":e[7]||(e[7]=u=>n.value.description=u),placeholder:"请简要描述项目内容、目标、预期成果等",rows:4,maxlength:500,"show-count":""},null,8,["value"])]),_:1})])]),Y.value?(r(),L("div",Ce,[t(oe,null,{default:l(()=>[t(h,{onClick:Q},{default:l(()=>e[14]||(e[14]=[d("取消",-1)])),_:1,__:[14]}),t(h,{type:"primary",onClick:ee,loading:F.value},{default:l(()=>e[15]||(e[15]=[d(" 保存项目信息 ",-1)])),_:1,__:[15]},8,["loading"])]),_:1})])):W("",!0)]),_:1},8,["model"])):W("",!0),a("div",Me,[e[19]||(e[19]=a("h4",{class:"section-title"},"申报材料上传",-1)),a("div",$e,[t(oe,null,{default:l(()=>[e[16]||(e[16]=a("span",null,"模板下载：",-1)),a("a",{onClick:e[8]||(e[8]=u=>N("申报书"))},"项目申报书模板.docx"),a("a",{onClick:e[9]||(e[9]=u=>N("预算"))},"预算表模板.xlsx"),a("a",{onClick:e[10]||(e[10]=u=>N("PPT"))},"汇报PPT模板.pptx")]),_:1,__:[16]})]),t(_,{label:"申报材料",name:"files",class:"upload-form-item"},{default:l(()=>[t(ce,{"file-list":T.value,"before-upload":te,onChange:ae,onRemove:le,multiple:"","list-type":"text",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx"},{default:l(()=>[t(h,{type:"primary",ghost:""},{default:l(()=>[t(ve(ye)),e[17]||(e[17]=d(" 上传文件 ",-1))]),_:1,__:[17]})]),_:1},8,["file-list"]),e[18]||(e[18]=a("div",{class:"upload-tips"},[a("p",null,"• 支持格式：PDF、Word、Excel、PPT"),a("p",null,"• 单个文件大小不超过10MB"),a("p",null,"• 必须包含：项目申报书、预算表")],-1))]),_:1,__:[18]})]),a("div",Ye,[t(oe,null,{default:l(()=>[t(h,{onClick:se,loading:$.value},{default:l(()=>e[20]||(e[20]=[d(" 保存草稿 ",-1)])),_:1,__:[20]},8,["loading"]),t(h,{type:"primary",onClick:v,loading:m.value},{default:l(()=>e[21]||(e[21]=[d(" 提交审核 ",-1)])),_:1,__:[21]},8,["loading"])]),_:1})])])}}},Te=ue(Pe,[["__scopeId","data-v-f2fb4677"]]);const Ue={class:"project-detail-page"},Le={class:"project-detail-header"},qe={class:"project-title"},Be={class:"project-detail-main"},Re={class:"project-steps-container"},Ie={class:"phase-section phase-立项"},Ve={class:"phase-section phase-在研"},Ae={class:"phase-section phase-结题"},Ee={class:"phase-section phase-归档"},Fe={class:"project-step-content"},Ne={class:"step-header"},Oe={class:"step-desc"},We={__name:"detail",setup(S){const H=fe(),s=_e(),c=M(0),D=[{key:"research",title:"研究方向调研",status:"wait",phase:"立项",desc:"水厂实地调研、交流座谈、组建项目组、集体讨论"},{key:"apply",title:"提交申请",status:"wait",phase:"立项",desc:"结合本单位下年度计划上报科研管理部门"},{key:"approval",title:"项目立项",status:"wait",phase:"立项",desc:"承担单位技术创新部审批立项"},{key:"kickoff",title:"项目开题",status:"wait",phase:"在研",desc:"纳入承担单位下年度计划、技术创新部专家团队"},{key:"implementation",title:"项目实施",status:"wait",phase:"在研",desc:"技术创新部监管管理、承担单位推进实施"},{key:"midterm",title:"中期汇报",status:"wait",phase:"在研",desc:"技术创新部专家团队、配合单位现场开展"},{key:"acceptance",title:"项目验收",status:"wait",phase:"结题",desc:"技术创新部专家团队相关职能部门"},{key:"archive",title:"项目归档",status:"wait",phase:"归档",desc:"承担单位技术创新部归档管理"}],m=X(()=>D[c.value]),$=X(()=>c.value<=2?"立项":c.value<=5?"在研":c.value===6?"结题":"归档"),F=X(()=>Math.round(c.value/(D.length-1)*100)),Y={立项:"blue",在研:"processing",结题:"orange",归档:"default"},P={立项:"立项",在研:"在研",结题:"结题",归档:"归档"};function A(v){return v<c.value?"finish":v===c.value?"process":"wait"}function n(v,g){v<=c.value&&(c.value=v)}function x(v){console.log("步骤提交:",m.value.title,v),c.value<D.length-1&&c.value++}function T(){H.back()}function J(){const v=s.params.id;return v&&v.startsWith("XM")?{code:v,name:"",type:"",leader:"",dept:"",start:"",end:"",status:"立项",desc:"",progress:0,stages:[],members:[],fund:{total:0,used:0,left:0},docs:[],logs:[{time:new Date().toISOString().split("T")[0],content:"项目创建"}]}:{code:"XM2024002",name:"水质监测系统",type:"横向",leader:"李四",dept:"管理部",start:"2024-01-01",end:"2024-12-31",status:"在研",desc:"本项目旨在提升水质监测自动化水平。",progress:60,stages:["需求分析","系统设计","开发测试","部署验收"],members:[{name:"李四",role:"负责人",phone:"13800000001"},{name:"王五",role:"成员",phone:"13800000002"}],fund:{total:100,used:60,left:40},docs:[{name:"项目立项书.pdf"},{name:"需求文档.docx"}],logs:[{time:"2024-01-01",content:"项目立项"},{time:"2024-03-01",content:"需求分析完成"},{time:"2024-05-01",content:"系统设计完成"}]}}const b=M(J()),Q={template:"<div>研究方向调研（待开发）</div>"},ee={template:"<div>项目立项（待开发）</div>"},te={template:"<div>项目开题（待开发）</div>"},ae={template:"<div>项目实施（待开发）</div>"},le={template:"<div>中期汇报（待开发）</div>"},N={template:"<div>项目验收（待开发）</div>"},se={template:"<div>项目归档（待开发）</div>"};return(v,g)=>{const z=p("a-button"),O=p("a-tag"),G=p("a-progress"),q=p("a-step"),B=p("a-steps");return r(),L("div",Ue,[a("div",Le,[t(z,{type:"link",onClick:T},{default:l(()=>g[0]||(g[0]=[d("返回",-1)])),_:1,__:[0]}),a("span",qe,y(b.value.name)+"（"+y(b.value.code)+"）",1),t(O,{color:Y[$.value]},{default:l(()=>[d(y(P[$.value]),1)]),_:1},8,["color"]),t(G,{percent:F.value,status:"active",style:{width:"200px","margin-left":"32px"}},null,8,["percent"])]),a("div",Be,[a("div",Re,[a("div",Ie,[g[1]||(g[1]=a("div",{class:"phase-header"},"立项阶段",-1)),t(B,{direction:"vertical",current:c.value,class:"phase-steps"},{default:l(()=>[(r(!0),L(K,null,Z(D.slice(0,3),(i,j)=>(r(),k(q,{key:i.key,title:i.title,status:A(j),onClick:E=>n(j,i),class:"step-item"},null,8,["title","status","onClick"]))),128))]),_:1},8,["current"])]),a("div",Ve,[g[2]||(g[2]=a("div",{class:"phase-header"},"在研阶段",-1)),t(B,{direction:"vertical",current:c.value-3,class:"phase-steps"},{default:l(()=>[(r(!0),L(K,null,Z(D.slice(3,6),(i,j)=>(r(),k(q,{key:i.key,title:i.title,status:A(j+3),onClick:E=>n(j+3,i),class:"step-item"},null,8,["title","status","onClick"]))),128))]),_:1},8,["current"])]),a("div",Ae,[g[3]||(g[3]=a("div",{class:"phase-header"},"结题阶段",-1)),t(B,{direction:"vertical",current:c.value-6,class:"phase-steps"},{default:l(()=>[(r(!0),L(K,null,Z(D.slice(6,7),(i,j)=>(r(),k(q,{key:i.key,title:i.title,status:A(j+6),onClick:E=>n(j+6,i),class:"step-item"},null,8,["title","status","onClick"]))),128))]),_:1},8,["current"])]),a("div",Ee,[g[4]||(g[4]=a("div",{class:"phase-header"},"归档阶段",-1)),t(B,{direction:"vertical",current:c.value-7,class:"phase-steps"},{default:l(()=>[(r(!0),L(K,null,Z(D.slice(7),(i,j)=>(r(),k(q,{key:i.key,title:i.title,status:A(j+7),onClick:E=>n(j+7,i),class:"step-item"},null,8,["title","status","onClick"]))),128))]),_:1},8,["current"])])]),a("div",Fe,[a("div",Ne,[a("h3",null,y(m.value.title),1),t(O,{color:Y[$.value]},{default:l(()=>[d(y(P[$.value]),1)]),_:1},8,["color"])]),a("div",Oe,[a("p",null,y(m.value.desc),1)]),m.value.key==="research"?(r(),k(Q,{key:0,project:b.value,onSubmit:x},null,8,["project"])):m.value.key==="apply"?(r(),k(Te,{key:1,project:b.value,onSubmit:x},null,8,["project"])):m.value.key==="approval"?(r(),k(ee,{key:2,project:b.value,onSubmit:x},null,8,["project"])):m.value.key==="kickoff"?(r(),k(te,{key:3,project:b.value,onSubmit:x},null,8,["project"])):m.value.key==="implementation"?(r(),k(ae,{key:4,project:b.value,onSubmit:x},null,8,["project"])):m.value.key==="midterm"?(r(),k(le,{key:5,project:b.value,onSubmit:x},null,8,["project"])):m.value.key==="acceptance"?(r(),k(N,{key:6,project:b.value,onSubmit:x},null,8,["project"])):m.value.key==="archive"?(r(),k(se,{key:7,project:b.value,onSubmit:x},null,8,["project"])):W("",!0)])])])}}},Ke=ue(We,[["__scopeId","data-v-1d3ff08f"]]);export{Ke as default};

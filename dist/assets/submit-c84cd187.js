import{a4 as se,f as m,c as R,o as ne,S as r,U as j,V as k,W as s,Z as d,k as a,X as o,u as I,G as i,F as le,Y as re,a0 as U,_ as ie}from"./vendor-9e962977.js";import{o as S,m as b,X as ue,P as de,F as ce,E as pe,Y as me,Z as _e}from"./antd-3abeaf7b.js";import{_ as ve}from"./index-b9d63c8b.js";const fe={class:"submit-container"},ye={class:"page-header"},ge={class:"header-content"},be={class:"page-title"},qe={class:"page-description"},he={class:"header-actions"},je={class:"form-section"},Ie={class:"section-header"},xe={class:"section-content"},Ce={class:"project-option"},Re={class:"project-name"},ke={class:"project-info"},we={class:"project-code"},De={class:"project-status"},Te={key:0,class:"selected-project-info"},Ue={class:"form-section"},Se={class:"section-header"},Le={class:"section-content"},Fe={key:0,class:"form-section"},Oe={class:"section-header"},Pe={class:"review-comments-content"},ze={class:"comments-text"},Ve={class:"form-section"},Ne={key:0,class:"resubmit-notice"},Me={class:"form-actions"},Be={__name:"submit",setup(Ae){const q=se(),V=m(),D=m(),L=m({allRequiredUploaded:!1,uploadedCount:0,totalCount:0}),T=m([]),w=R(()=>q.currentRoute.value.query.resubmit==="true"),_=R(()=>q.currentRoute.value.query.improvement==="true"),N=R(()=>_.value?"提交整改材料":w.value?"重新提交开题申请":"提交开题申请"),M=R(()=>_.value?"根据验收会议的整改要求，提交相应的整改材料和说明":w.value?"根据审核意见修改完善后重新提交验收申请":"填写项目验收申请信息并上传相关材料"),n=m({projectId:void 0,expectedDate:void 0,acceptanceType:void 0,description:"",remarks:""}),B={projectId:[{required:!0,message:"请选择项目"}],expectedDate:[{required:!0,message:"请选择预期验收时间"}],acceptanceType:[{required:!0,message:"请选择验收类型"}],description:[{required:!0,message:"请填写申请说明"}]},x=m([{id:1,name:"智慧城市大数据平台建设项目",code:"PROJ-2024-001",status:"实施中",startDate:"2023-06-01",endDate:"2024-05-31",leader:"张三",budget:500},{id:2,name:"区块链供应链金融平台",code:"PROJ-2024-002",status:"实施中",startDate:"2023-08-01",endDate:"2024-07-31",leader:"李四",budget:300},{id:3,name:"AI智能客服系统",code:"PROJ-2024-003",status:"即将结束",startDate:"2023-09-01",endDate:"2024-03-31",leader:"王五",budget:200}]),g=R(()=>x.value.find(t=>t.id===n.value.projectId));m([{key:"acceptance_report",name:"项目验收报告",description:"详细的项目验收报告，包含项目完成情况、技术指标等",fileList:[]},{key:"summary_report",name:"项目总结报告",description:"项目实施过程总结，包含经验教训、改进建议等",fileList:[]},{key:"achievement_materials",name:"成果汇总材料",description:"项目产出的各类成果材料，如软件、报告、专利等",fileList:[]},{key:"financial_report",name:"财务决算报告",description:"项目资金使用情况的详细财务报告",fileList:[]}]),m([{key:"ip_list",name:"知识产权清单",description:"项目产生的专利、软著等知识产权清单",fileList:[]},{key:"test_report",name:"测试报告",description:"系统测试、性能测试等相关测试报告",fileList:[]},{key:"user_manual",name:"用户手册",description:"系统使用手册、操作指南等文档",fileList:[]},{key:"other_materials",name:"其他材料",description:"其他与项目验收相关的补充材料",fileList:[]}]);const F=m(!1),C=m("");m(!1),m({});const A=t=>({实施中:"blue",即将结束:"orange",已完成:"green",暂停:"red"})[t]||"default",E=(t,e)=>{const c=x.value.find(l=>l.id===e.value);return c&&(c.name.toLowerCase().includes(t.toLowerCase())||c.code.toLowerCase().includes(t.toLowerCase()))},J=t=>t&&t<S().startOf("day"),X=()=>{q.go(-1)},Y=t=>{console.log("Selected project:",t)},Z=t=>{const{configId:e,file:c,action:l}=t;if(l==="add")T.value.push({configId:e,file:c});else if(l==="remove"){const f=T.value.findIndex(v=>v.configId===e);f>-1&&T.value.splice(f,1)}},G=t=>{L.value=t},W=t=>{console.log("开题材料配置已更新:",t)},$=async()=>{try{b.success("草稿保存成功")}catch{b.error("草稿保存失败")}},H=async t=>{var e,c;try{if(F.value=!0,!L.value.allRequiredUploaded){const p=(e=D.value)==null?void 0:e.validateRequiredFiles();if(p&&!p.valid){b.error(`请上传以下必传材料：${p.missingFiles.join("、")}`);return}}const l=((c=D.value)==null?void 0:c.getAllUploadedFiles())||[],f=q.currentRoute.value,v=f.query.resubmit==="true",y=f.query.improvement==="true",h={...t,materials:l.map(p=>({configId:p.configId,categoryName:p.config.categoryName,fileName:p.file.name,fileSize:p.file.size,isRequired:p.config.isRequired})),statusUpdate:v?{from:"material_rejected",to:"material_reviewing",reason:"用户重新提交材料，状态自动变更为材料审核中"}:null,submitType:v?"resubmit":y?"improvement":"normal",projectId:f.query.projectId?parseInt(f.query.projectId):t.projectId};console.log("Submit data:",h),console.log("Submit type:",h.submitType),h.statusUpdate&&console.log("Status will be updated:",h.statusUpdate),await new Promise(p=>setTimeout(p,2e3)),v?b.success("材料重新提交成功，状态已更新为材料审核中"):y?b.success("整改材料提交成功"):b.success("开题申请提交成功"),q.push("/th_qd/opening/applicant/manage")}catch{b.error("提交失败，请重试")}finally{F.value=!1}};return ne(()=>{const t=q.currentRoute.value;if(console.log(t.query),t.query.resubmit==="true"){if(t.query.projectId){const e=parseInt(t.query.projectId);x.value.find(l=>l.id===e)&&(n.value.projectId=e)}t.query.expectedTime&&(n.value.expectedDate=S(t.query.expectedTime)),t.query.description&&(n.value.description=decodeURIComponent(t.query.description)),t.query.rejectionReason?C.value=decodeURIComponent(t.query.rejectionReason):t.query.reviewComments&&(C.value=decodeURIComponent(t.query.reviewComments)),n.value.acceptanceType="final",b.info("已自动填充项目信息，请重新上传验收材料并完善申请信息")}if(t.query.improvement==="true"){if(t.query.projectId){const e=parseInt(t.query.projectId);x.value.find(l=>l.id===e)&&(n.value.projectId=e)}t.query.expectedTime&&(n.value.expectedDate=S(t.query.expectedTime)),t.query.description&&(n.value.description=decodeURIComponent(t.query.description)),t.query.improvementRequirements&&(C.value=decodeURIComponent(t.query.improvementRequirements)),n.value.acceptanceType="final",b.info("已自动填充项目信息，请根据整改要求上传相关材料")}}),(t,e)=>{const c=r("a-button"),l=r("a-select-option"),f=r("a-select"),v=r("a-form-item"),y=r("a-descriptions-item"),h=r("a-tag"),p=r("a-descriptions"),K=r("a-date-picker"),O=r("a-col"),Q=r("a-row"),P=r("a-textarea"),z=r("a-alert"),ee=r("MaterialTemplateSync"),te=r("a-space"),ae=r("a-form"),oe=r("a-card");return j(),k("div",fe,[s("div",ye,[s("div",ge,[s("h1",be,d(N.value),1),s("p",qe,d(M.value),1)]),s("div",he,[a(c,{onClick:X},{default:o(()=>[a(I(ue)),e[5]||(e[5]=i(" 返回列表 ",-1))]),_:1,__:[5]})])]),a(oe,{bordered:!1},{default:o(()=>[a(ae,{ref_key:"formRef",ref:V,model:n.value,rules:B,layout:"vertical",onFinish:H},{default:o(()=>[s("div",je,[s("div",Ie,[s("h3",null,[a(I(de)),e[6]||(e[6]=i(" 项目选择 ",-1))]),e[7]||(e[7]=s("p",null,"选择需要申请开题的项目",-1))]),s("div",xe,[a(v,{label:"选择项目",name:"projectId",rules:[{required:!0,message:"请选择项目"}]},{default:o(()=>[a(f,{value:n.value.projectId,"onUpdate:value":e[0]||(e[0]=u=>n.value.projectId=u),placeholder:"请选择项目",size:"large","show-search":"","filter-option":E,onChange:Y},{default:o(()=>[(j(!0),k(le,null,re(x.value,u=>(j(),ie(l,{key:u.id,value:u.id},{default:o(()=>[s("div",Ce,[s("div",Re,d(u.name),1),s("div",ke,[s("span",we,d(u.code),1),s("span",De,d(u.status),1)])])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),g.value?(j(),k("div",Te,[a(p,{column:2,bordered:"",size:"small"},{default:o(()=>[a(y,{label:"项目名称",span:2},{default:o(()=>[i(d(g.value.name),1)]),_:1}),a(y,{label:"项目编号"},{default:o(()=>[i(d(g.value.code),1)]),_:1}),a(y,{label:"项目状态"},{default:o(()=>[a(h,{color:A(g.value.status)},{default:o(()=>[i(d(g.value.status),1)]),_:1},8,["color"])]),_:1}),a(y,{label:"开始时间"},{default:o(()=>[i(d(g.value.startDate),1)]),_:1}),a(y,{label:"计划结束时间"},{default:o(()=>[i(d(g.value.endDate),1)]),_:1}),a(y,{label:"项目负责人"},{default:o(()=>[i(d(g.value.leader),1)]),_:1}),a(y,{label:"项目总预算"},{default:o(()=>[i(d(g.value.budget)+"万元 ",1)]),_:1})]),_:1})])):U("",!0)])]),s("div",Ue,[s("div",Se,[s("h3",null,[a(I(ce)),e[8]||(e[8]=i(" 申请信息 ",-1))]),e[9]||(e[9]=s("p",null,"填写开题申请的基本信息",-1))]),s("div",Le,[a(Q,{gutter:24},{default:o(()=>[a(O,{xs:24,md:12},{default:o(()=>[a(v,{label:"预期开题时间",name:"expectedDate",rules:[{required:!0,message:"请选择预期验收时间"}]},{default:o(()=>[a(K,{value:n.value.expectedDate,"onUpdate:value":e[1]||(e[1]=u=>n.value.expectedDate=u),placeholder:"请选择预期开题时间",size:"large",style:{width:"100%"},"disabled-date":J},null,8,["value"])]),_:1})]),_:1}),a(O,{xs:24,md:12},{default:o(()=>[a(v,{label:"开题类型",name:"acceptanceType",rules:[{required:!0,message:"请选择验收类型"}]},{default:o(()=>[a(f,{value:n.value.acceptanceType,"onUpdate:value":e[2]||(e[2]=u=>n.value.acceptanceType=u),placeholder:"请选择验收类型",size:"large"},{default:o(()=>[a(l,{value:"preliminary"},{default:o(()=>e[10]||(e[10]=[i("初步开题",-1)])),_:1,__:[10]}),a(l,{value:"formal"},{default:o(()=>e[11]||(e[11]=[i("正式开题",-1)])),_:1,__:[11]}),a(l,{value:"special"},{default:o(()=>e[12]||(e[12]=[i("专项开题",-1)])),_:1,__:[12]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(v,{label:"申请说明",name:"description",rules:[{required:!0,message:"请填写申请说明"}]},{default:o(()=>[a(P,{value:n.value.description,"onUpdate:value":e[3]||(e[3]=u=>n.value.description=u),placeholder:"请详细说明项目准备情况、研究方案及开题准备情况",rows:4,size:"large","show-count":"",maxlength:500},null,8,["value"])]),_:1}),a(v,{label:"备注说明",name:"remarks"},{default:o(()=>[a(P,{value:n.value.remarks,"onUpdate:value":e[4]||(e[4]=u=>n.value.remarks=u),placeholder:"其他需要说明的事项（选填）",rows:3,size:"large","show-count":"",maxlength:200},null,8,["value"])]),_:1})])]),(w.value||_.value)&&C.value?(j(),k("div",Fe,[s("div",Oe,[s("h3",null,[a(I(pe)),i(" "+d(_.value?"整改要求":"审核意见"),1)]),s("p",null,"请仔细阅读以下"+d(_.value?"整改要求":"审核意见")+"，并据此修改完善申请材料",1)]),s("div",Pe,[a(z,{message:_.value?"开题会议整改要求":"材料审核意见",type:_.value?"warning":"error","show-icon":""},{description:o(()=>[s("div",ze,d(C.value),1)]),_:1},8,["message","type"])])])):U("",!0),s("div",Ve,[w.value||_.value?(j(),k("div",Ne,[a(z,{message:_.value?"整改材料提交":"重新提交提醒",description:_.value?"请根据开题会议的整改要求，上传相应的整改材料和说明文档。":"由于材料审核未通过，请根据审核意见重新准备并上传所有必需材料。",type:_.value?"warning":"info","show-icon":"",style:{"margin-bottom":"16px"}},null,8,["message","description","type"])])):U("",!0),a(ee,{ref_key:"materialTemplateSyncRef",ref:D,"business-type":"opening",onFilesChange:Z,onValidationChange:G,onConfigUpdate:W},null,512)]),s("div",Me,[a(te,null,{default:o(()=>[a(c,{onClick:$},{default:o(()=>[a(I(me)),e[13]||(e[13]=i(" 保存草稿 ",-1))]),_:1,__:[13]}),a(c,{type:"primary","html-type":"submit"},{default:o(()=>[a(I(_e)),e[14]||(e[14]=i(" 提交申请 ",-1))]),_:1,__:[14]})]),_:1})])]),_:1},8,["model"])]),_:1})])}}},Ye=ve(Be,[["__scopeId","data-v-3bda23b9"]]);export{Ye as default};

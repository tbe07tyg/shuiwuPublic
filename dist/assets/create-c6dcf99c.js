import{a4 as K,f as m,c as Q,S as p,U as x,V as U,W as i,k as a,X as n,G as c,F as Z,Y as ee}from"./vendor-e4b530e5.js";import{m as b,o as M}from"./antd-19bac614.js";import{M as ae}from"./MaterialTemplateSync-4cbe366a.js";import{_ as le}from"./index-053c0381.js";const te={class:"project-create-page"},oe={class:"page-header"},ne={class:"create-content"},se={class:"form-section"},ue={class:"form-section"},ie={class:"form-section"},de={class:"members-list"},re={class:"form-section"},pe={class:"form-actions"},ve={__name:"create",setup(me){const D=K(),R=m(),g=m(!1),_=m(!1),y=m(),w=m({allRequiredUploaded:!1,uploadedCount:0,totalCount:0}),h=m([]),l=m({name:"",type:"",leader:"",dept:"",startDate:null,endDate:null,description:"",budget:null,fundSource:"",budgetDesc:"",members:[{name:"",role:"负责人",phone:""}]}),O=[{label:"纵向课题",value:"纵向"},{label:"横向课题",value:"横向"},{label:"自筹项目",value:"自筹"},{label:"合作项目",value:"合作"}],C=[{label:"张三",value:"张三"},{label:"李四",value:"李四"},{label:"王五",value:"王五"},{label:"赵六",value:"赵六"},{label:"钱七",value:"钱七"}],V=[{label:"研发部",value:"研发部"},{label:"技术部",value:"技术部"},{label:"管理部",value:"管理部"},{label:"市场部",value:"市场部"},{label:"运营部",value:"运营部"}],j=[{label:"国家自然科学基金",value:"国家自然科学基金"},{label:"省部级科研项目",value:"省部级科研项目"},{label:"企业委托",value:"企业委托"},{label:"自有资金",value:"自有资金"},{label:"其他",value:"其他"}],I=Q(()=>C),N=[{label:"负责人",value:"负责人"},{label:"主要成员",value:"主要成员"},{label:"参与成员",value:"参与成员"},{label:"顾问",value:"顾问"}],T={name:[{required:!0,message:"请输入项目名称"},{min:5,max:100,message:"项目名称长度在5-100个字符"}],type:[{required:!0,message:"请选择项目类型"}],leader:[{required:!0,message:"请选择项目负责人"}],dept:[{required:!0,message:"请选择所属部门"}],startDate:[{required:!0,message:"请选择计划开始时间"}],endDate:[{required:!0,message:"请选择计划结束时间"}],description:[{required:!0,message:"请输入项目简介"},{min:20,max:1e3,message:"项目简介长度在20-1000个字符"}],budget:[{required:!0,message:"请输入申请预算"}],fundSource:[{required:!0,message:"请选择资金来源"}]};function $(o){return o&&o<M().subtract(1,"day")}function L(o){return l.value.startDate?o&&o<=l.value.startDate:o&&o<M()}function k(o,e){return e.label.toLowerCase().includes(o.toLowerCase())}function z(){l.value.members.push({name:"",role:"参与成员",phone:""})}function B(o){l.value.members.length>1&&l.value.members.splice(o,1)}function E(){_.value=!0,setTimeout(()=>{_.value=!1,b.success("项目草稿已保存")},1e3)}function X(o){const{configId:e,file:r,action:v}=o;if(v==="add")h.value.push({configId:e,file:r});else if(v==="remove"){const s=h.value.findIndex(u=>u.configId===e);s>-1&&h.value.splice(s,1)}}function Y(o){w.value=o}function A(o){console.log("立项申请材料配置已更新:",o)}function G(){var r,v;if(l.value.members.filter(s=>s.name&&s.role).length===0){b.error("请至少添加一个团队成员");return}if(!w.value.allRequiredUploaded){const s=(r=y.value)==null?void 0:r.validateRequiredFiles();if(s&&!s.valid){b.error(`请上传以下必传材料：${s.missingFiles.join("、")}`);return}}g.value=!0;const e=((v=y.value)==null?void 0:v.getAllUploadedFiles())||[];setTimeout(()=>{g.value=!1;const s=`XM${new Date().getFullYear()}${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,u={...l.value,projectCode:s,materials:e.map(d=>({configId:d.configId,categoryName:d.config.categoryName,fileName:d.file.name,fileSize:d.file.size,isRequired:d.config.isRequired}))};console.log("Project submit data:",u),b.success(`项目创建成功！项目编号：${s}`),D.push(`/project/detail/${s}`)},2e3)}function P(){D.back()}return(o,e)=>{const r=p("a-button"),v=p("a-alert"),s=p("a-input"),u=p("a-form-item"),d=p("a-select"),S=p("a-date-picker"),q=p("a-textarea"),W=p("a-input-number"),H=p("a-space"),J=p("a-form");return x(),U("div",te,[i("div",oe,[a(r,{type:"link",onClick:P},{default:n(()=>e[10]||(e[10]=[c("返回",-1)])),_:1,__:[10]}),e[11]||(e[11]=i("h1",{class:"page-title"},"新建项目",-1))]),i("div",ne,[a(v,{message:"项目创建流程",description:"请完整填写项目基本信息，创建成功后将自动进入立项申报流程。",type:"info","show-icon":"",style:{"margin-bottom":"32px"}}),a(J,{model:l.value,rules:T,onFinish:G,ref_key:"formRef",ref:R,layout:"horizontal","label-col":{span:4},"wrapper-col":{span:16}},{default:n(()=>[i("div",se,[e[12]||(e[12]=i("h3",{class:"section-title"},"项目基本信息",-1)),a(u,{label:"项目名称",name:"name"},{default:n(()=>[a(s,{value:l.value.name,"onUpdate:value":e[0]||(e[0]=t=>l.value.name=t),placeholder:"请输入项目名称",maxlength:100,"show-count":""},null,8,["value"])]),_:1}),a(u,{label:"项目类型",name:"type"},{default:n(()=>[a(d,{value:l.value.type,"onUpdate:value":e[1]||(e[1]=t=>l.value.type=t),options:O,placeholder:"请选择项目类型"},null,8,["value"])]),_:1}),a(u,{label:"项目负责人",name:"leader"},{default:n(()=>[a(d,{value:l.value.leader,"onUpdate:value":e[2]||(e[2]=t=>l.value.leader=t),options:C,placeholder:"请选择项目负责人","show-search":"","filter-option":k},null,8,["value"])]),_:1}),a(u,{label:"所属部门",name:"dept"},{default:n(()=>[a(d,{value:l.value.dept,"onUpdate:value":e[3]||(e[3]=t=>l.value.dept=t),options:V,placeholder:"请选择所属部门"},null,8,["value"])]),_:1}),a(u,{label:"计划开始时间",name:"startDate"},{default:n(()=>[a(S,{value:l.value.startDate,"onUpdate:value":e[4]||(e[4]=t=>l.value.startDate=t),placeholder:"请选择开始时间",style:{width:"100%"},"disabled-date":$},null,8,["value"])]),_:1}),a(u,{label:"计划结束时间",name:"endDate"},{default:n(()=>[a(S,{value:l.value.endDate,"onUpdate:value":e[5]||(e[5]=t=>l.value.endDate=t),placeholder:"请选择结束时间",style:{width:"100%"},"disabled-date":L},null,8,["value"])]),_:1}),a(u,{label:"项目简介",name:"description"},{default:n(()=>[a(q,{value:l.value.description,"onUpdate:value":e[6]||(e[6]=t=>l.value.description=t),placeholder:"请简要描述项目背景、目标、主要内容和预期成果等",rows:5,maxlength:1e3,"show-count":""},null,8,["value"])]),_:1})]),i("div",ue,[e[14]||(e[14]=i("h3",{class:"section-title"},"预算信息",-1)),a(u,{label:"申请预算",name:"budget"},{default:n(()=>[a(W,{value:l.value.budget,"onUpdate:value":e[7]||(e[7]=t=>l.value.budget=t),min:0,max:999999,precision:2,style:{width:"300px"},placeholder:"请输入申请预算","addon-after":"万元"},null,8,["value"]),e[13]||(e[13]=i("div",{class:"form-tip"},"请根据项目实际需要填写预算金额",-1))]),_:1,__:[13]}),a(u,{label:"资金来源",name:"fundSource"},{default:n(()=>[a(d,{value:l.value.fundSource,"onUpdate:value":e[8]||(e[8]=t=>l.value.fundSource=t),options:j,placeholder:"请选择资金来源"},null,8,["value"])]),_:1}),a(u,{label:"预算说明",name:"budgetDesc"},{default:n(()=>[a(q,{value:l.value.budgetDesc,"onUpdate:value":e[9]||(e[9]=t=>l.value.budgetDesc=t),placeholder:"请简要说明预算构成和用途（可选）",rows:3,maxlength:500,"show-count":""},null,8,["value"])]),_:1})]),i("div",ie,[e[17]||(e[17]=i("h3",{class:"section-title"},"团队信息",-1)),a(u,{label:"团队成员",name:"members"},{default:n(()=>[i("div",de,[(x(!0),U(Z,null,ee(l.value.members,(t,F)=>(x(),U("div",{key:F,class:"member-item"},[a(d,{value:t.name,"onUpdate:value":f=>t.name=f,options:I.value,placeholder:"选择成员",style:{width:"200px"},"show-search":"","filter-option":k},null,8,["value","onUpdate:value","options"]),a(d,{value:t.role,"onUpdate:value":f=>t.role=f,options:N,placeholder:"选择角色",style:{width:"120px","margin-left":"12px"}},null,8,["value","onUpdate:value"]),a(s,{value:t.phone,"onUpdate:value":f=>t.phone=f,placeholder:"联系电话",style:{width:"150px","margin-left":"12px"}},null,8,["value","onUpdate:value"]),a(r,{type:"text",danger:"",onClick:f=>B(F),disabled:l.value.members.length<=1,style:{"margin-left":"12px"}},{default:n(()=>e[15]||(e[15]=[c(" 删除 ",-1)])),_:2,__:[15]},1032,["onClick","disabled"])]))),128)),a(r,{type:"dashed",onClick:z,style:{width:"100%","margin-top":"12px"}},{default:n(()=>e[16]||(e[16]=[c(" + 添加团队成员 ",-1)])),_:1,__:[16]})])]),_:1})]),i("div",re,[e[18]||(e[18]=i("h3",{class:"section-title"},"申请材料",-1)),a(ae,{ref_key:"materialTemplateSyncRef",ref:y,"business-type":"apply",onFilesChange:X,onValidationChange:Y,onConfigUpdate:A},null,512)]),i("div",pe,[a(H,{size:"large"},{default:n(()=>[a(r,{onClick:E,loading:_.value},{default:n(()=>e[19]||(e[19]=[c(" 保存草稿 ",-1)])),_:1,__:[19]},8,["loading"]),a(r,{type:"primary","html-type":"submit",loading:g.value},{default:n(()=>e[20]||(e[20]=[c(" 创建项目 ",-1)])),_:1,__:[20]},8,["loading"])]),_:1})])]),_:1},8,["model"])])])}}},_e=le(ve,[["__scopeId","data-v-f2a94b03"]]);export{_e as default};

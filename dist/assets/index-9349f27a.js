import{e as Fe,U as Me,a4 as Se,K as We,a5 as Pe,a6 as Ze,t as Ee,o as me,m as A,D as He,J as Qe,a7 as et,d as tt,a8 as at}from"./antd-19bac614.js";import{_ as Ue}from"./index-053c0381.js";import{c as X,f as m,o as je,S as i,U as u,V as v,W as s,k as e,u as R,G as o,X as t,F as $,Y as re,_ as C,a0 as x,Z as c,$ as st}from"./vendor-e4b530e5.js";const nt={class:"budget-reporter-page"},ot={class:"page-header"},lt={class:"header-content"},ut={class:"page-title"},it={class:"user-role"},rt={class:"header-actions"},dt={class:"project-info"},ct={class:"info-item"},pt={class:"value"},_t={class:"info-item"},vt={class:"value budget-amount"},mt={class:"info-item"},gt={class:"value used-amount"},ft={class:"info-item"},yt={class:"value remaining-amount"},kt={class:"progress-section"},xt={key:1,class:"main-content"},bt={class:"report-section"},wt={style:{"margin-bottom":"16px"}},Rt={key:0},It={class:"analysis-section"},Ct={class:"smart-upload-container"},At={key:0,class:"upload-step"},ht={class:"ant-upload-drag-icon"},$t={style:{"margin-top":"16px","text-align":"right"}},Pt={key:1,class:"recognition-step"},Mt={class:"recognition-content"},St={class:"preview-container"},Ut={class:"image-preview"},jt=["src"],Bt={class:"recognition-progress"},zt={class:"progress-text"},Dt={key:2,class:"confirm-step"},Tt={class:"image-preview-small"},Yt=["src"],Ot={key:0,style:{"margin-left":"8px"}},Lt={key:0,class:"field-warning"},qt={key:0,class:"ai-suggestion"},Ft={key:0,class:"field-warning"},Vt={key:0,class:"ai-info"},Xt={style:{"margin-top":"24px","text-align":"right"}},Nt={__name:"BudgetReporter",props:{userPermissions:{type:Object,default:()=>({})}},emits:["switch-role"],setup(de,{emit:ee}){const L=de,N=ee,B=X(()=>L.userPermissions.roles&&L.userPermissions.roles.includes("manager")),U=()=>{N("switch-role","manager")},Z=X(()=>p.value.date&&p.value.categoryId&&p.value.amount&&p.value.description),G=m("budget"),I=m(""),g=m(!1),k=m(null),P=m(!1),M=m(0),q=m([]),F=m(!1),K=m(0),E=m(""),J=m(""),p=m({date:null,categoryId:"",amount:null,description:"",suggestedCategory:"",merchantInfo:""}),z=m({success:!1,confidence:0}),ne=m([{id:"P001",name:"XXX科研项目",totalBudget:5e5,usedAmount:32e4,remainingAmount:18e4},{id:"P002",name:"YYY技术研发项目",totalBudget:8e5,usedAmount:48e4,remainingAmount:32e4}]),S=X(()=>ne.value.find(r=>r.id===I.value)),te=X(()=>S.value?Math.round(S.value.usedAmount/S.value.totalBudget*100):0),ge=X(()=>{const r=te.value;return r>=95?"#ff4d4f":r>=90?"#fa8c16":r>=70?"#52c41a":"#1890ff"}),H=m([{id:"equipment",name:"设备费"},{id:"material",name:"材料费"},{id:"personnel",name:"人员费"},{id:"other",name:"其他费用"}]),fe=m([{id:1,category:"设备费",budgetAmount:2e5,usedAmount:12e4,remainingAmount:8e4,executionRate:60},{id:2,category:"材料费",budgetAmount:15e4,usedAmount:1e5,remainingAmount:5e4,executionRate:67},{id:3,category:"人员费",budgetAmount:1e5,usedAmount:8e4,remainingAmount:2e4,executionRate:80},{id:4,category:"其他费用",budgetAmount:5e4,usedAmount:2e4,remainingAmount:3e4,executionRate:40}]),j=m([{id:1,date:"2024-01-15",category:"设备费",amount:15e3,description:"购买实验设备XXX",status:"待审核",submitter:"张三"},{id:2,date:"2024-01-10",category:"材料费",amount:8e3,description:"采购实验材料",status:"已审核",submitter:"张三"}]),ye=m([...j.value,{id:3,date:"2024-01-05",category:"人员费",amount:12e3,description:"研究人员劳务费",status:"已审核",submitter:"李四"}]),f=m({date:null,categoryId:"",amount:null,description:"",fileList:[]}),d=[{title:"预算科目",dataIndex:"category",key:"category"},{title:"预算金额",dataIndex:"budgetAmount",key:"budgetAmount"},{title:"已使用",dataIndex:"usedAmount",key:"usedAmount"},{title:"剩余",dataIndex:"remainingAmount",key:"remainingAmount"},{title:"执行率",dataIndex:"executionRate",key:"executionRate"}],n=[{title:"使用日期",dataIndex:"date",key:"date"},{title:"科目",dataIndex:"category",key:"category"},{title:"金额",dataIndex:"amount",key:"amount"},{title:"用途说明",dataIndex:"description",key:"description"},{title:"状态",dataIndex:"status",key:"status"},{title:"操作",key:"actions"}],ae=[{title:"使用日期",dataIndex:"date",key:"date"},{title:"科目",dataIndex:"category",key:"category"},{title:"金额",dataIndex:"amount",key:"amount"},{title:"用途说明",dataIndex:"description",key:"description"},{title:"填报人",dataIndex:"submitter",key:"submitter"},{title:"状态",dataIndex:"status",key:"status"}],h=r=>r.toLocaleString(),D=r=>r>=95?"#ff4d4f":r>=90?"#fa8c16":r>=70?"#52c41a":"#1890ff",T=r=>({待审核:"orange",已审核:"green",已驳回:"red"})[r]||"default",ce=r=>{console.log("选择项目:",r)},Y=()=>{k.value=null,f.value={date:null,categoryId:"",amount:null,description:"",fileList:[]},g.value=!0},oe=r=>{var a;k.value=r,f.value={date:me(r.date),categoryId:((a=H.value.find(y=>y.name===r.category))==null?void 0:a.id)||"",amount:r.amount,description:r.description,fileList:[]},g.value=!0},ke=r=>{const a=j.value.findIndex(y=>y.id===r.id);a>-1&&(j.value.splice(a,1),A.success("删除成功"))},xe=()=>{var a;if(!f.value.date||!f.value.categoryId||!f.value.amount||!f.value.description){A.error("请填写完整信息");return}const r=((a=H.value.find(y=>y.id===f.value.categoryId))==null?void 0:a.name)||"";if(k.value){const y=j.value.findIndex(Q=>Q.id===k.value.id);y>-1&&(j.value[y]={...j.value[y],date:f.value.date.format("YYYY-MM-DD"),category:r,amount:f.value.amount,description:f.value.description}),A.success("修改成功")}else{const y={id:Date.now(),date:f.value.date.format("YYYY-MM-DD"),category:r,amount:f.value.amount,description:f.value.description,status:"待审核",submitter:"张三"};j.value.unshift(y),A.success("提交成功，等待审核")}g.value=!1},le=()=>{g.value=!1},ue=r=>["application/pdf","image/jpeg","image/png"].includes(r.type)?(r.size/1024/1024<5||A.error("文件大小不能超过5MB"),!1):(A.error("只能上传PDF、JPG、PNG格式的文件"),!1),ie=()=>{P.value=!0,M.value=0,se()},be=()=>{P.value=!1,se()},se=()=>{M.value=0,q.value=[],F.value=!1,K.value=0,E.value="",J.value="",p.value={date:null,categoryId:"",amount:null,description:"",suggestedCategory:"",merchantInfo:""},z.value={success:!1,confidence:0}},W=r=>r.type.startsWith("image/")?(r.size/1024/1024<10||A.error("图片大小不能超过10MB"),!1):(A.error("只能上传图片格式的文件"),!1),we=r=>{if(r.file.status==="done"||r.file.originFileObj){const a=new FileReader;a.onload=y=>{J.value=y.target.result},a.readAsDataURL(r.file.originFileObj||r.file)}},Re=async()=>{if(q.value.length===0){A.error("请先上传凭证图片");return}F.value=!0,M.value=1,K.value=0;const r=[{progress:20,text:"正在预处理图片..."},{progress:40,text:"正在识别文字信息..."},{progress:60,text:"正在提取关键数据..."},{progress:80,text:"正在智能分析内容..."},{progress:100,text:"识别完成！"}];for(let a of r)await new Promise(y=>setTimeout(y,800)),K.value=a.progress,E.value=a.text;await _(),F.value=!1,M.value=2},_=async()=>{const r=[{success:!0,confidence:92,date:me("2024-01-15"),amount:2500,description:"购买实验设备 - 数字万用表",suggestedCategory:"设备费",categoryId:"equipment",merchantInfo:"北京科技器材有限公司"},{success:!0,confidence:88,date:me("2024-01-12"),amount:850,description:"采购实验材料 - 化学试剂",suggestedCategory:"材料费",categoryId:"material",merchantInfo:"上海化工材料商城"},{success:!0,confidence:95,date:me("2024-01-10"),amount:1200,description:"研究人员交通费报销",suggestedCategory:"其他费用",categoryId:"other",merchantInfo:"滴滴出行"}],a=r[Math.floor(Math.random()*r.length)];z.value={success:a.success,confidence:a.confidence},p.value={date:a.date,categoryId:a.categoryId,amount:a.amount,description:a.description,suggestedCategory:a.suggestedCategory,merchantInfo:a.merchantInfo},A.success(`识别成功！置信度: ${a.confidence}%`)},b=()=>{se(),P.value=!0},pe=()=>{var y;if(!Z.value){A.error("请完善必填信息");return}const r=((y=H.value.find(Q=>Q.id===p.value.categoryId))==null?void 0:y.name)||"",a={id:Date.now(),date:p.value.date.format("YYYY-MM-DD"),category:r,amount:p.value.amount,description:p.value.description,status:"待审核",submitter:"张三",isSmartFilled:!0};j.value.unshift(a),P.value=!1,A.success("智能填报成功！记录已提交审核"),se()};return je(()=>{I.value="P001"}),(r,a)=>{const y=i("a-tag"),Q=i("a-select-option"),Ie=i("a-select"),V=i("a-button"),Ce=i("a-progress"),Ae=i("a-card"),he=i("a-table"),_e=i("a-tab-pane"),Be=i("a-space"),ve=i("a-col"),ze=i("a-row"),Ve=i("a-tabs"),$e=i("a-step"),Xe=i("a-steps"),De=i("a-alert"),Ne=i("a-upload-dragger"),Ge=i("a-spin"),O=i("a-form-item"),Te=i("a-date-picker"),Ye=i("a-input-number"),Oe=i("a-textarea"),Le=i("a-form"),qe=i("a-modal"),Ke=i("a-upload");return u(),v("div",nt,[s("div",ot,[s("div",lt,[s("h1",ut,[e(R(Fe)),a[14]||(a[14]=o(" 经费执行进度 - 填报页面 ",-1))]),s("div",it,[e(y,{color:"blue"},{default:t(()=>[e(R(Me)),a[15]||(a[15]=o(" 我的权限：填报员 ",-1))]),_:1,__:[15]})])]),s("div",rt,[e(Ie,{value:I.value,"onUpdate:value":a[0]||(a[0]=l=>I.value=l),placeholder:"选择项目",style:{width:"280px","margin-right":"12px"},onChange:ce},{default:t(()=>[(u(!0),v($,null,re(ne.value,l=>(u(),C(Q,{key:l.id,value:l.id},{default:t(()=>[o(c(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),B.value?(u(),C(V,{key:0,type:"default",onClick:U,style:{"border-color":"#fa8c16",color:"#fa8c16"}},{default:t(()=>[e(R(Se)),a[16]||(a[16]=o(" 切换到管理视图 ",-1))]),_:1,__:[16]})):x("",!0)])]),S.value?(u(),C(Ae,{key:0,class:"project-info-card"},{default:t(()=>[s("div",dt,[s("div",ct,[a[17]||(a[17]=s("span",{class:"label"},"项目名称：",-1)),s("span",pt,c(S.value.name),1)]),s("div",_t,[a[18]||(a[18]=s("span",{class:"label"},"预算总额：",-1)),s("span",vt,"¥"+c(h(S.value.totalBudget)),1)]),s("div",mt,[a[19]||(a[19]=s("span",{class:"label"},"已使用：",-1)),s("span",gt,"¥"+c(h(S.value.usedAmount))+" ("+c(te.value)+"%)",1)]),s("div",ft,[a[20]||(a[20]=s("span",{class:"label"},"剩余：",-1)),s("span",yt,"¥"+c(h(S.value.remainingAmount))+" ("+c(100-te.value)+"%)",1)])]),s("div",kt,[e(Ce,{percent:te.value,"stroke-color":ge.value,"stroke-width":8,style:{"margin-top":"16px"}},null,8,["percent","stroke-color"])])]),_:1})):x("",!0),S.value?(u(),v("div",xt,[e(Ve,{activeKey:G.value,"onUpdate:activeKey":a[1]||(a[1]=l=>G.value=l),type:"card"},{default:t(()=>[e(_e,{key:"budget",tab:"预算明细"},{default:t(()=>[e(he,{columns:d,"data-source":fe.value,pagination:!1,bordered:""},{bodyCell:t(({column:l,record:w})=>[l.key==="executionRate"?(u(),C(Ce,{key:0,percent:w.executionRate,size:"small","stroke-color":D(w.executionRate)},null,8,["percent","stroke-color"])):l.key==="budgetAmount"?(u(),v($,{key:1},[o(" ¥"+c(h(w.budgetAmount)),1)],64)):l.key==="usedAmount"?(u(),v($,{key:2},[o(" ¥"+c(h(w.usedAmount)),1)],64)):l.key==="remainingAmount"?(u(),v($,{key:3},[o(" ¥"+c(h(w.remainingAmount)),1)],64)):x("",!0)]),_:1},8,["data-source"])]),_:1}),e(_e,{key:"report",tab:"经费填报"},{default:t(()=>[s("div",bt,[s("div",wt,[e(Be,null,{default:t(()=>[e(V,{type:"primary",onClick:Y},{default:t(()=>[e(R(We)),a[21]||(a[21]=o(" 手动填报 ",-1))]),_:1,__:[21]}),e(V,{type:"default",onClick:ie,style:{"border-color":"#52c41a",color:"#52c41a"}},{default:t(()=>[e(R(Pe)),a[22]||(a[22]=o(" 智能凭证填报 ",-1))]),_:1,__:[22]})]),_:1})]),e(he,{columns:n,"data-source":j.value,pagination:{pageSize:10},bordered:""},{bodyCell:t(({column:l,record:w})=>[l.key==="description"?(u(),v("div",Rt,[o(c(w.description)+" ",1),w.isSmartFilled?(u(),C(y,{key:0,color:"green",size:"small",style:{"margin-left":"8px"}},{default:t(()=>[e(R(Pe)),a[23]||(a[23]=o(" 智能填报 ",-1))]),_:1,__:[23]})):x("",!0)])):l.key==="amount"?(u(),v($,{key:1},[o(" ¥"+c(h(w.amount)),1)],64)):l.key==="status"?(u(),C(y,{key:2,color:T(w.status)},{default:t(()=>[o(c(w.status),1)]),_:2},1032,["color"])):l.key==="actions"?(u(),v($,{key:3},[e(V,{type:"link",size:"small",onClick:Je=>oe(w),disabled:w.status==="已审核"},{default:t(()=>a[24]||(a[24]=[o(" 编辑 ",-1)])),_:2,__:[24]},1032,["onClick","disabled"]),e(V,{type:"link",size:"small",danger:"",onClick:Je=>ke(w),disabled:w.status==="已审核"},{default:t(()=>a[25]||(a[25]=[o(" 删除 ",-1)])),_:2,__:[25]},1032,["onClick","disabled"])],64)):x("",!0)]),_:1},8,["data-source"])])]),_:1}),e(_e,{key:"records",tab:"使用记录"},{default:t(()=>[e(he,{columns:ae,"data-source":ye.value,pagination:{pageSize:15},bordered:""},{bodyCell:t(({column:l,record:w})=>[l.key==="amount"?(u(),v($,{key:0},[o(" ¥"+c(h(w.amount)),1)],64)):l.key==="status"?(u(),C(y,{key:1,color:T(w.status)},{default:t(()=>[o(c(w.status),1)]),_:2},1032,["color"])):x("",!0)]),_:1},8,["data-source"])]),_:1}),e(_e,{key:"analysis",tab:"执行分析"},{default:t(()=>[s("div",It,[e(ze,{gutter:16},{default:t(()=>[e(ve,{span:12},{default:t(()=>[e(Ae,{title:"月度使用趋势",size:"small"},{default:t(()=>a[26]||(a[26]=[s("div",{class:"chart-container"}," 图表加载中... ",-1)])),_:1,__:[26]})]),_:1}),e(ve,{span:12},{default:t(()=>[e(Ae,{title:"科目分布",size:"small"},{default:t(()=>a[27]||(a[27]=[s("div",{class:"chart-container"}," 图表加载中... ",-1)])),_:1,__:[27]})]),_:1})]),_:1})])]),_:1})]),_:1},8,["activeKey"])])):x("",!0),e(qe,{open:P.value,"onUpdate:open":a[7]||(a[7]=l=>P.value=l),title:"智能凭证填报",width:"700px",footer:null,onCancel:be},{default:t(()=>[s("div",Ct,[e(Xe,{current:M.value,style:{"margin-bottom":"24px"}},{default:t(()=>[e($e,{title:"上传凭证"}),e($e,{title:"智能识别"}),e($e,{title:"确认信息"})]),_:1},8,["current"]),M.value===0?(u(),v("div",At,[e(De,{message:"凭证要求",type:"info","show-icon":"",style:{"margin-bottom":"16px"}},{description:t(()=>a[28]||(a[28]=[s("div",{class:"voucher-requirements"},[s("p",null,[s("strong",null,"请确保凭证图片包含以下信息：")]),s("ul",null,[s("li",null,[o("📅 "),s("strong",null,"消费日期"),o("：明确的交易时间")]),s("li",null,[o("💰 "),s("strong",null,"消费金额"),o("：清晰的数字金额")]),s("li",null,[o("🏪 "),s("strong",null,"商家信息"),o("：商户名称或经营范围")]),s("li",null,[o("📝 "),s("strong",null,"消费项目"),o("：具体的商品或服务名称")]),s("li",null,[o("🧾 "),s("strong",null,"发票类型"),o("：增值税发票、收据等")])]),s("p",{class:"tip"},[o("💡 "),s("em",null,"支持发票、收据、购物小票等各类消费凭证")])],-1)])),_:1}),e(Ne,{"file-list":q.value,"onUpdate:fileList":a[2]||(a[2]=l=>q.value=l),"before-upload":W,accept:"image/*","max-count":1,onChange:we},{default:t(()=>[s("p",ht,[e(R(Ze))]),a[29]||(a[29]=s("p",{class:"ant-upload-text"},"点击或拖拽凭证图片到此区域上传",-1)),a[30]||(a[30]=s("p",{class:"ant-upload-hint"}," 支持 JPG、PNG、JPEG 格式，文件大小不超过 10MB ",-1))]),_:1,__:[29,30]},8,["file-list"]),s("div",$t,[e(V,{type:"primary",onClick:Re,disabled:q.value.length===0,loading:F.value},{default:t(()=>[e(R(Pe)),a[31]||(a[31]=o(" 开始识别 ",-1))]),_:1,__:[31]},8,["disabled","loading"])])])):x("",!0),M.value===1?(u(),v("div",Pt,[s("div",Mt,[e(Ge,{spinning:F.value,tip:"正在智能识别凭证信息..."},{default:t(()=>[s("div",St,[s("div",Ut,[J.value?(u(),v("img",{key:0,src:J.value,alt:"凭证预览"},null,8,jt)):x("",!0)]),s("div",Bt,[e(Ce,{percent:K.value,"stroke-color":{"0%":"#108ee9","100%":"#87d068"}},null,8,["percent"]),s("p",zt,c(E.value),1)])])]),_:1},8,["spinning"])])])):x("",!0),M.value===2?(u(),v("div",Dt,[e(De,{message:"请仔细核对识别结果",type:"warning","show-icon":"",style:{"margin-bottom":"16px"},description:"系统已自动识别凭证信息，请核对准确性并进行必要的修正。"}),e(ze,{gutter:16},{default:t(()=>[e(ve,{span:10},{default:t(()=>[s("div",Tt,[J.value?(u(),v("img",{key:0,src:J.value,alt:"凭证预览"},null,8,Yt)):x("",!0)])]),_:1}),e(ve,{span:14},{default:t(()=>[e(Le,{model:p.value,"label-col":{span:6},"wrapper-col":{span:18}},{default:t(()=>[e(O,{label:"识别状态"},{default:t(()=>[e(y,{color:z.value.success?"green":"red"},{default:t(()=>[o(c(z.value.success?"识别成功":"识别失败"),1)]),_:1},8,["color"]),z.value.confidence?(u(),v("span",Ot," 置信度: "+c(z.value.confidence)+"% ",1)):x("",!0)]),_:1}),e(O,{label:"消费日期",required:""},{default:t(()=>[e(Te,{value:p.value.date,"onUpdate:value":a[3]||(a[3]=l=>p.value.date=l),style:{width:"100%"},status:p.value.date?"":"warning"},null,8,["value","status"]),p.value.date?x("",!0):(u(),v("div",Lt," ⚠️ 未能识别到日期，请手动选择 "))]),_:1}),e(O,{label:"预算科目",required:""},{default:t(()=>[e(Ie,{value:p.value.categoryId,"onUpdate:value":a[4]||(a[4]=l=>p.value.categoryId=l),placeholder:"请选择或确认科目",status:p.value.categoryId?"":"warning"},{default:t(()=>[(u(!0),v($,null,re(H.value,l=>(u(),C(Q,{key:l.id,value:l.id},{default:t(()=>[o(c(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","status"]),p.value.suggestedCategory?(u(),v("div",qt," 💡 AI建议: "+c(p.value.suggestedCategory),1)):x("",!0)]),_:1}),e(O,{label:"消费金额",required:""},{default:t(()=>[e(Ye,{value:p.value.amount,"onUpdate:value":a[5]||(a[5]=l=>p.value.amount=l),min:0,precision:2,style:{width:"100%"},placeholder:"请确认金额",status:p.value.amount?"":"warning"},null,8,["value","status"]),p.value.amount?x("",!0):(u(),v("div",Ft," ⚠️ 未能识别到金额，请手动输入 "))]),_:1}),e(O,{label:"用途说明",required:""},{default:t(()=>[e(Oe,{value:p.value.description,"onUpdate:value":a[6]||(a[6]=l=>p.value.description=l),rows:3,placeholder:"请确认或补充用途说明",status:p.value.description?"":"warning"},null,8,["value","status"]),p.value.merchantInfo?(u(),v("div",Vt," 🏪 识别商家: "+c(p.value.merchantInfo),1)):x("",!0)]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),s("div",Xt,[e(Be,null,{default:t(()=>[e(V,{onClick:b},{default:t(()=>a[32]||(a[32]=[o("重新上传",-1)])),_:1,__:[32]}),e(V,{type:"primary",onClick:pe,disabled:!Z.value},{default:t(()=>a[33]||(a[33]=[o(" 确认提交 ",-1)])),_:1,__:[33]},8,["disabled"])]),_:1})])])):x("",!0)])]),_:1},8,["open"]),e(qe,{open:g.value,"onUpdate:open":a[13]||(a[13]=l=>g.value=l),title:k.value?"编辑经费使用记录":"手动填报经费记录",width:"600px",onOk:xe,onCancel:le},{default:t(()=>[e(Le,{model:f.value,"label-col":{span:6},"wrapper-col":{span:18}},{default:t(()=>[e(O,{label:"使用日期",required:""},{default:t(()=>[e(Te,{value:f.value.date,"onUpdate:value":a[8]||(a[8]=l=>f.value.date=l),style:{width:"100%"}},null,8,["value"])]),_:1}),e(O,{label:"预算科目",required:""},{default:t(()=>[e(Ie,{value:f.value.categoryId,"onUpdate:value":a[9]||(a[9]=l=>f.value.categoryId=l),placeholder:"请选择科目"},{default:t(()=>[(u(!0),v($,null,re(H.value,l=>(u(),C(Q,{key:l.id,value:l.id},{default:t(()=>[o(c(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e(O,{label:"使用金额",required:""},{default:t(()=>[e(Ye,{value:f.value.amount,"onUpdate:value":a[10]||(a[10]=l=>f.value.amount=l),min:0,precision:2,style:{width:"100%"},placeholder:"请输入金额"},null,8,["value"])]),_:1}),e(O,{label:"用途说明",required:""},{default:t(()=>[e(Oe,{value:f.value.description,"onUpdate:value":a[11]||(a[11]=l=>f.value.description=l),rows:3,placeholder:"请详细说明经费使用用途"},null,8,["value"])]),_:1}),e(O,{label:"发票附件"},{default:t(()=>[e(Ke,{"file-list":f.value.fileList,"onUpdate:fileList":a[12]||(a[12]=l=>f.value.fileList=l),"before-upload":ue,accept:".pdf,.jpg,.jpeg,.png"},{default:t(()=>[e(V,null,{default:t(()=>[e(R(Ee)),a[34]||(a[34]=o(" 选择文件 ",-1))]),_:1,__:[34]})]),_:1},8,["file-list"]),a[35]||(a[35]=s("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 支持格式：PDF、JPG、PNG，文件大小不超过5MB ",-1))]),_:1,__:[35]})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},Gt=Ue(Nt,[["__scopeId","data-v-b560c7c2"]]);const Kt={class:"budget-manager-page"},Jt={class:"page-header"},Wt={class:"header-content"},Zt={class:"page-title"},Et={class:"user-role"},Ht={class:"header-actions"},Qt={class:"stats-cards"},ea={class:"stat-content"},ta={class:"stat-icon total"},aa={class:"stat-info"},sa={class:"stat-value"},na={class:"stat-content"},oa={class:"stat-icon executed"},la={class:"stat-info"},ua={class:"stat-value"},ia={class:"stat-content"},ra={class:"stat-icon rate"},da={class:"stat-info"},ca={class:"stat-value"},pa={class:"stat-content"},_a={class:"stat-icon warning"},va={class:"stat-info"},ma={class:"stat-value"},ga={class:"filter-toolbar"},fa={class:"main-content"},ya={class:"analysis-content"},ka={class:"ranking-list"},xa={class:"project-info"},ba={class:"project-name"},wa={class:"project-rate"},Ra={class:"progress-bar"},Ia={key:0},Ca={__name:"BudgetManager",props:{userPermissions:{type:Object,default:()=>({})}},emits:["switch-role"],setup(de,{emit:ee}){const L=de,N=ee,B=X(()=>L.userPermissions.roles&&L.userPermissions.roles.includes("reporter")),U=()=>{N("switch-role","reporter")},Z=m("projects"),G=m(!1),I=m(null),g=m({project:"",year:"2024",status:"",keyword:""}),k=m({totalBudget:5e7,executedAmount:32e6,executionRate:64,warningProjects:12}),P=m([{id:"P001",name:"XXX科研项目",manager:"张教授",totalBudget:5e5,executedAmount:32e4,executionRate:64,status:"normal",details:[{category:"设备费",budgetAmount:2e5,usedAmount:12e4,executionRate:60},{category:"材料费",budgetAmount:15e4,usedAmount:1e5,executionRate:67},{category:"人员费",budgetAmount:1e5,usedAmount:8e4,executionRate:80},{category:"其他费用",budgetAmount:5e4,usedAmount:2e4,executionRate:40}]},{id:"P002",name:"YYY技术研发",manager:"李博士",totalBudget:8e5,executedAmount:72e4,executionRate:90,status:"warning"},{id:"P003",name:"ZZZ创新项目",manager:"王主任",totalBudget:3e5,executedAmount:15e4,executionRate:50,status:"normal"}]),M=X(()=>{let d=P.value;return g.value.project&&(d=d.filter(n=>n.id===g.value.project)),g.value.status&&(d=d.filter(n=>n.status===g.value.status)),g.value.keyword&&(d=d.filter(n=>n.name.includes(g.value.keyword))),d}),q=X(()=>P.value.filter(d=>d.executionRate>=85).map(d=>({...d,warningType:d.executionRate>=95?"超支预警":"接近预算"}))),F=X(()=>[...P.value].sort((d,n)=>n.executionRate-d.executionRate).map(d=>({...d,rateDesc:d.executionRate>=95?"超预期":d.executionRate>=80?"良好":"滞后"}))),K=[{title:"项目名称",dataIndex:"name",key:"name"},{title:"项目负责人",dataIndex:"manager",key:"manager"},{title:"预算总额",dataIndex:"totalBudget",key:"totalBudget"},{title:"已执行",dataIndex:"executedAmount",key:"executedAmount"},{title:"执行率",dataIndex:"executionRate",key:"executionRate"},{title:"状态",dataIndex:"status",key:"status"},{title:"操作",key:"actions"}],E=[{title:"项目名称",dataIndex:"name",key:"name"},{title:"执行率",dataIndex:"executionRate",key:"executionRate"},{title:"预警类型",dataIndex:"warningType",key:"warningType"},{title:"项目负责人",dataIndex:"manager",key:"manager"},{title:"操作",key:"actions"}],J=[{title:"科目",dataIndex:"category",key:"category"},{title:"预算金额",dataIndex:"budgetAmount",key:"budgetAmount"},{title:"已使用",dataIndex:"usedAmount",key:"usedAmount"},{title:"执行率",dataIndex:"executionRate",key:"executionRate"}],p=d=>d.toLocaleString(),z=d=>d>=95?"#ff4d4f":d>=90?"#fa8c16":d>=70?"#52c41a":"#1890ff",ne=d=>({normal:"green",warning:"orange",danger:"red"})[d]||"default",S=d=>({normal:"正常",warning:"预警",danger:"超标"})[d]||"未知",te=d=>d==="超支预警"?"red":"orange",ge=d=>d===0?"rank-first":d===1?"rank-second":d===2?"rank-third":"",H=()=>{console.log("搜索:",g.value.keyword)},fe=d=>{I.value=d,G.value=!0},j=d=>{A.info(`查看 ${d.name} 的详细分析`)},ye=d=>{A.info(`处理 ${d.name} 的预警`)},f=()=>{A.success("报表导出成功")};return je(()=>{console.log("管理页面已加载")}),(d,n)=>{const ae=i("a-tag"),h=i("a-button"),D=i("a-card"),T=i("a-col"),ce=i("a-row"),Y=i("a-select-option"),oe=i("a-select"),ke=i("a-input-search"),xe=i("a-space"),le=i("a-progress"),ue=i("a-table"),ie=i("a-tab-pane"),be=i("a-alert"),se=i("a-tabs"),W=i("a-descriptions-item"),we=i("a-descriptions"),Re=i("a-modal");return u(),v("div",Kt,[s("div",Jt,[s("div",Wt,[s("h1",Zt,[e(R(He)),n[6]||(n[6]=o(" 经费执行进度 - 管理页面 ",-1))]),s("div",Et,[e(ae,{color:"red"},{default:t(()=>[e(R(Se)),n[7]||(n[7]=o(" 我的权限：管理员 ",-1))]),_:1,__:[7]})])]),s("div",Ht,[B.value?(u(),C(h,{key:0,type:"default",onClick:U,style:{"border-color":"#52c41a",color:"#52c41a","margin-right":"12px"}},{default:t(()=>[e(R(Me)),n[8]||(n[8]=o(" 切换到填报视图 ",-1))]),_:1,__:[8]})):x("",!0),e(h,{type:"primary",onClick:f},{default:t(()=>[e(R(Qe)),n[9]||(n[9]=o(" 导出报表 ",-1))]),_:1,__:[9]})])]),s("div",Qt,[e(ce,{gutter:16},{default:t(()=>[e(T,{span:6},{default:t(()=>[e(D,{class:"stat-card"},{default:t(()=>[s("div",ea,[s("div",ta,[e(R(et))]),s("div",aa,[s("div",sa,"¥"+c(p(k.value.totalBudget)),1),n[10]||(n[10]=s("div",{class:"stat-label"},"总预算",-1))])])]),_:1})]),_:1}),e(T,{span:6},{default:t(()=>[e(D,{class:"stat-card"},{default:t(()=>[s("div",na,[s("div",oa,[e(R(Fe))]),s("div",la,[s("div",ua,"¥"+c(p(k.value.executedAmount)),1),n[11]||(n[11]=s("div",{class:"stat-label"},"已执行",-1))])])]),_:1})]),_:1}),e(T,{span:6},{default:t(()=>[e(D,{class:"stat-card"},{default:t(()=>[s("div",ia,[s("div",ra,[e(R(tt))]),s("div",da,[s("div",ca,c(k.value.executionRate)+"%",1),n[12]||(n[12]=s("div",{class:"stat-label"},"执行率",-1))])])]),_:1})]),_:1}),e(T,{span:6},{default:t(()=>[e(D,{class:"stat-card"},{default:t(()=>[s("div",pa,[s("div",_a,[e(R(at))]),s("div",va,[s("div",ma,c(k.value.warningProjects),1),n[13]||(n[13]=s("div",{class:"stat-label"},"预警项目",-1))])])]),_:1})]),_:1})]),_:1})]),s("div",ga,[e(xe,null,{default:t(()=>[e(oe,{value:g.value.project,"onUpdate:value":n[0]||(n[0]=_=>g.value.project=_),placeholder:"全部项目",style:{width:"150px"}},{default:t(()=>[e(Y,{value:""},{default:t(()=>n[14]||(n[14]=[o("全部项目",-1)])),_:1,__:[14]}),(u(!0),v($,null,re(P.value,_=>(u(),C(Y,{key:_.id,value:_.id},{default:t(()=>[o(c(_.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),e(oe,{value:g.value.year,"onUpdate:value":n[1]||(n[1]=_=>g.value.year=_),placeholder:"年份",style:{width:"120px"}},{default:t(()=>[e(Y,{value:"2024"},{default:t(()=>n[15]||(n[15]=[o("2024年",-1)])),_:1,__:[15]}),e(Y,{value:"2023"},{default:t(()=>n[16]||(n[16]=[o("2023年",-1)])),_:1,__:[16]})]),_:1},8,["value"]),e(oe,{value:g.value.status,"onUpdate:value":n[2]||(n[2]=_=>g.value.status=_),placeholder:"状态",style:{width:"120px"}},{default:t(()=>[e(Y,{value:""},{default:t(()=>n[17]||(n[17]=[o("全部状态",-1)])),_:1,__:[17]}),e(Y,{value:"normal"},{default:t(()=>n[18]||(n[18]=[o("正常",-1)])),_:1,__:[18]}),e(Y,{value:"warning"},{default:t(()=>n[19]||(n[19]=[o("预警",-1)])),_:1,__:[19]}),e(Y,{value:"danger"},{default:t(()=>n[20]||(n[20]=[o("超标",-1)])),_:1,__:[20]})]),_:1},8,["value"]),e(ke,{value:g.value.keyword,"onUpdate:value":n[3]||(n[3]=_=>g.value.keyword=_),placeholder:"搜索项目名称",style:{width:"200px"},onSearch:H},null,8,["value"])]),_:1})]),s("div",fa,[e(se,{activeKey:Z.value,"onUpdate:activeKey":n[4]||(n[4]=_=>Z.value=_),type:"card"},{default:t(()=>[e(ie,{key:"projects",tab:"项目列表"},{default:t(()=>[e(ue,{columns:K,"data-source":M.value,pagination:{pageSize:10},bordered:""},{bodyCell:t(({column:_,record:b})=>[_.key==="totalBudget"?(u(),v($,{key:0},[o(" ¥"+c(p(b.totalBudget)),1)],64)):_.key==="executedAmount"?(u(),v($,{key:1},[o(" ¥"+c(p(b.executedAmount)),1)],64)):_.key==="executionRate"?(u(),C(le,{key:2,percent:b.executionRate,size:"small","stroke-color":z(b.executionRate)},null,8,["percent","stroke-color"])):_.key==="status"?(u(),C(ae,{key:3,color:ne(b.status)},{default:t(()=>[o(c(S(b.status)),1)]),_:2},1032,["color"])):_.key==="actions"?(u(),v($,{key:4},[e(h,{type:"link",size:"small",onClick:pe=>fe(b)},{default:t(()=>n[21]||(n[21]=[o(" 详情 ",-1)])),_:2,__:[21]},1032,["onClick"]),e(h,{type:"link",size:"small",onClick:pe=>j(b)},{default:t(()=>n[22]||(n[22]=[o(" 分析 ",-1)])),_:2,__:[22]},1032,["onClick"])],64)):x("",!0)]),_:1},8,["data-source"])]),_:1}),e(ie,{key:"analysis",tab:"统计分析"},{default:t(()=>[s("div",ya,[e(ce,{gutter:16},{default:t(()=>[e(T,{span:8},{default:t(()=>[e(D,{title:"执行趋势图",size:"small"},{default:t(()=>n[23]||(n[23]=[s("div",{class:"chart-container"}," 图表加载中... ",-1)])),_:1,__:[23]})]),_:1}),e(T,{span:8},{default:t(()=>[e(D,{title:"科目分布饼图",size:"small"},{default:t(()=>n[24]||(n[24]=[s("div",{class:"chart-container"}," 图表加载中... ",-1)])),_:1,__:[24]})]),_:1}),e(T,{span:8},{default:t(()=>[e(D,{title:"月度对比柱状图",size:"small"},{default:t(()=>n[25]||(n[25]=[s("div",{class:"chart-container"}," 图表加载中... ",-1)])),_:1,__:[25]})]),_:1})]),_:1}),e(D,{title:"执行效率排行榜",style:{"margin-top":"16px"}},{default:t(()=>[s("div",ka,[(u(!0),v($,null,re(F.value,(_,b)=>(u(),v("div",{key:_.id,class:"ranking-item"},[s("div",{class:st(["rank-number",ge(b)])},c(b+1),3),s("div",xa,[s("div",ba,c(_.name),1),s("div",wa,c(_.executionRate)+"% ("+c(_.rateDesc)+")",1)]),s("div",Ra,[e(le,{percent:_.executionRate,size:"small","stroke-color":z(_.executionRate),"show-info":!1},null,8,["percent","stroke-color"])])]))),128))])]),_:1})])]),_:1}),e(ie,{key:"warning",tab:"预警监控"},{default:t(()=>[e(be,{message:"系统检测到以下项目存在预警情况",type:"warning","show-icon":"",style:{"margin-bottom":"16px"}}),e(ue,{columns:E,"data-source":q.value,pagination:!1,bordered:""},{bodyCell:t(({column:_,record:b})=>[_.key==="executionRate"?(u(),C(le,{key:0,percent:b.executionRate,size:"small","stroke-color":z(b.executionRate)},null,8,["percent","stroke-color"])):_.key==="warningType"?(u(),C(ae,{key:1,color:te(b.warningType)},{default:t(()=>[o(c(b.warningType),1)]),_:2},1032,["color"])):_.key==="actions"?(u(),C(h,{key:2,type:"link",size:"small",onClick:pe=>ye(b)},{default:t(()=>n[26]||(n[26]=[o(" 处理 ",-1)])),_:2,__:[26]},1032,["onClick"])):x("",!0)]),_:1},8,["data-source"])]),_:1})]),_:1},8,["activeKey"])]),e(Re,{open:G.value,"onUpdate:open":n[5]||(n[5]=_=>G.value=_),title:"项目执行详情",width:"800px",footer:null},{default:t(()=>[I.value?(u(),v("div",Ia,[e(we,{column:2,bordered:""},{default:t(()=>[e(W,{label:"项目名称"},{default:t(()=>[o(c(I.value.name),1)]),_:1}),e(W,{label:"项目负责人"},{default:t(()=>[o(c(I.value.manager),1)]),_:1}),e(W,{label:"预算总额"},{default:t(()=>[o("¥"+c(p(I.value.totalBudget)),1)]),_:1}),e(W,{label:"已执行金额"},{default:t(()=>[o("¥"+c(p(I.value.executedAmount)),1)]),_:1}),e(W,{label:"执行率"},{default:t(()=>[o(c(I.value.executionRate)+"%",1)]),_:1}),e(W,{label:"项目状态"},{default:t(()=>[e(ae,{color:ne(I.value.status)},{default:t(()=>[o(c(S(I.value.status)),1)]),_:1},8,["color"])]),_:1})]),_:1}),n[27]||(n[27]=s("h4",{style:{"margin-top":"24px"}},"科目执行明细",-1)),e(ue,{columns:J,"data-source":I.value.details||[],pagination:!1,size:"small",bordered:""},null,8,["data-source"])])):x("",!0)]),_:1},8,["open"])])}}},Aa=Ue(Ca,[["__scopeId","data-v-380d49c8"]]);const ha={class:"payment-container"},$a={key:0,class:"loading-container"},Pa={key:1,class:"content-area"},Ma={style:{"margin-top":"16px","text-align":"center"}},Sa={__name:"index",setup(de){const ee=m(!0),L=m(!1),N=m(""),B=m(""),U=m({}),Z=async()=>{await new Promise(g=>setTimeout(g,1e3)),U.value={roles:["reporter","manager"],defaultRole:"reporter"},ee.value=!1,U.value.roles.length===1?B.value=U.value.roles[0]:U.value.roles.length>1?L.value=!0:B.value="no-permission"},G=()=>{B.value=N.value,L.value=!1},I=g=>{U.value.roles.includes(g)&&(B.value=g)};return je(()=>{Z()}),(g,k)=>{const P=i("a-spin"),M=i("a-radio-button"),q=i("a-radio-group"),F=i("a-button"),K=i("a-card");return u(),v("div",ha,[k[6]||(k[6]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},"经费执行进度"),s("div",{class:"page-desc"},"项目资金管理，按角色划分填报与审核职责，实时监控预算执行情况")],-1)),ee.value?(u(),v("div",$a,[e(P,{size:"large"}),k[1]||(k[1]=s("p",null,"正在识别用户权限...",-1))])):L.value?(u(),v("div",Pa,[e(K,{title:"经费执行进度 - 角色选择",class:"role-card"},{default:t(()=>[k[5]||(k[5]=s("p",null,"系统检测到您有多个角色权限，请选择要使用的角色：",-1)),e(q,{value:N.value,"onUpdate:value":k[0]||(k[0]=E=>N.value=E),style:{width:"100%"}},{default:t(()=>[e(M,{value:"reporter",style:{width:"50%","text-align":"center"}},{default:t(()=>[e(R(Me)),k[2]||(k[2]=o(" 填报人员 ",-1))]),_:1,__:[2]}),e(M,{value:"manager",style:{width:"50%","text-align":"center"}},{default:t(()=>[e(R(Se)),k[3]||(k[3]=o(" 管理角色 ",-1))]),_:1,__:[3]})]),_:1},8,["value"]),s("div",Ma,[e(F,{type:"primary",onClick:G,disabled:!N.value},{default:t(()=>k[4]||(k[4]=[o(" 确认进入 ",-1)])),_:1,__:[4]},8,["disabled"])])]),_:1,__:[5]})])):B.value==="reporter"?(u(),C(Gt,{key:2,"user-permissions":U.value,onSwitchRole:I},null,8,["user-permissions"])):B.value==="manager"?(u(),C(Aa,{key:3,"user-permissions":U.value,onSwitchRole:I},null,8,["user-permissions"])):x("",!0)])}}},za=Ue(Sa,[["__scopeId","data-v-5c01c4ba"]]);export{za as default};

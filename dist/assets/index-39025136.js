import{f as g,c as j,o as me,a5 as ve,S as u,U as o,V as d,W as t,k as n,X as i,a0 as k,_ as C,F as b,Y as $,Z as l,G as y,u as v,$ as z,a7 as _e}from"./vendor-e4b530e5.js";import{m as T,f as ge,r as fe,v as ye,F as he,G as ke,J as Ce,a9 as we,E as De,p as je,a8 as be,o as R}from"./antd-19bac614.js";import{_ as xe}from"./index-053c0381.js";const Me={class:"progress-container"},Ne={class:"action-bar"},Pe={class:"project-option"},Oe={class:"project-name"},ze={class:"project-info"},Te={key:0,class:"content-area"},Ue={class:"project-header"},$e={class:"project-basic"},Re={class:"project-stats"},qe={class:"stat-item"},Fe={class:"stat-value"},Se={class:"stat-item"},Ve={class:"stat-value"},Be={class:"stat-item"},Ie={class:"stat-value"},Le={class:"progress-overview"},Xe={class:"progress-header"},Ye={class:"progress-stats"},Ae={class:"progress-text"},Ee={class:"progress-detail"},Ge={class:"progress-milestones"},Qe={class:"milestone-info"},Je={class:"milestone-name"},We={class:"milestone-date"},Ze={class:"timeline-container"},He={class:"timeline-wrapper"},Ke={class:"timeline-content"},et={class:"node-header"},tt={class:"node-time"},st={key:0},at={key:1},nt={key:2},ot={class:"node-desc"},lt={key:0,class:"materials-section"},it={class:"materials-header"},dt={key:0,class:"materials-list"},rt={class:"material-info"},ut={class:"material-name"},ct={class:"material-actions"},pt={key:1,class:"no-materials"},mt={class:"node-actions"},vt={class:"timeline-item approval-node"},_t={class:"timeline-dot completed"},gt={class:"timeline-content"},ft={class:"node-time"},yt={__name:"index",setup(ht){const p=g(""),q=g({}),F=g({}),x=g(!1),M=g(null),X=g(null),w=g({reason:""}),h=g([{id:"P001",name:"XXX科研项目",leader:"张教授",type:"国家自然科学基金",status:"实施中",startDate:"2024-01-01",approvalDate:"2024-01-15"},{id:"P002",name:"YYY技术研发",leader:"李博士",type:"省级科技计划",status:"实施中",startDate:"2024-02-01",approvalDate:"2024-02-10"}]),_=j(()=>h.value.find(s=>s.id===p.value)),m=g([]),Y=j(()=>[...m.value].reverse()),S=j(()=>m.value.length+1),I=j(()=>m.value.filter(e=>e.status==="completed").length+1),V=j(()=>S.value===0?0:Math.round(I.value/S.value*100)),A=j(()=>{var s,e,N,f,D,U;return _.value?[{name:"立项",date:_.value.approvalDate,status:"completed"},{name:"开题",date:(s=m.value.find(r=>r.id==="opening-meeting"))==null?void 0:s.scheduledDate,status:((e=m.value.find(r=>r.id==="opening-meeting"))==null?void 0:e.status)||"waiting"},{name:"中期",date:(N=m.value.find(r=>r.id==="midterm-meeting"))==null?void 0:N.scheduledDate,status:((f=m.value.find(r=>r.id==="midterm-meeting"))==null?void 0:f.status)||"waiting"},{name:"验收",date:(D=m.value.find(r=>r.id==="acceptance-meeting"))==null?void 0:D.scheduledDate,status:((U=m.value.find(r=>r.id==="acceptance-meeting"))==null?void 0:U.status)||"waiting"}]:[]}),E=s=>{const e={P001:[{id:"opening-submit",name:"项目开题 - 资料提交",type:"submission",status:"completed",scheduledDate:"2024-02-15",completedDate:"2024-02-12",description:"提交开题报告、研究方案等相关材料",materials:[{id:"m1",name:"开题报告.pdf",status:"approved"},{id:"m2",name:"研究方案.docx",status:"approved"}]},{id:"opening-meeting",name:"项目开题 - 报告会",type:"meeting",status:"completed",scheduledDate:"2024-02-20",completedDate:"2024-02-20",description:"参加开题报告会，专家评审"},{id:"midterm-submit",name:"项目中期 - 资料提交",type:"submission",status:"in-progress",scheduledDate:"2024-06-15",description:"提交中期检查报告、阶段性成果等材料",materials:[{id:"m3",name:"中期报告.pdf",status:"submitted"},{id:"m4",name:"阶段成果.docx",status:"pending"}]},{id:"midterm-meeting",name:"项目中期 - 报告会",type:"meeting",status:"waiting",description:"参加中期检查报告会"},{id:"acceptance-submit",name:"项目验收 - 资料提交",type:"submission",status:"waiting",description:"提交验收报告、最终成果等材料"},{id:"acceptance-meeting",name:"项目验收 - 报告会",type:"meeting",status:"waiting",description:"参加项目验收报告会"}],P002:[{id:"opening-submit",name:"项目开题 - 资料提交",type:"submission",status:"overdue",scheduledDate:"2024-03-01",description:"提交开题报告、技术方案等相关材料",materials:[{id:"m1",name:"开题报告.pdf",status:"rejected"}]},{id:"opening-meeting",name:"项目开题 - 报告会",type:"meeting",status:"waiting",description:"参加开题报告会，专家评审"}]};m.value=e[s]||[]},B=s=>{E(s)},G=s=>({"completed-node":s.status==="completed","in-progress-node":s.status==="in-progress","overdue-node":s.status==="overdue","waiting-node":s.status==="waiting"}),Q=s=>({completed:s.status==="completed","in-progress":s.status==="in-progress",overdue:s.status==="overdue",waiting:s.status==="waiting"}),J=s=>{switch(s.status){case"completed":return"CheckCircleOutlined";case"in-progress":return"PlayCircleOutlined";case"overdue":return"AlertOutlined";default:return"MinusCircleOutlined"}},W=s=>({completed:"已完成","in-progress":"进行中",overdue:"已超期",waiting:"等待中"})[s]||"未知",Z=s=>({pending:"orange",submitted:"blue",approved:"green",rejected:"red"})[s]||"default",H=s=>({pending:"待提交",submitted:"已提交",approved:"已通过",rejected:"已打回"})[s]||"未知",K=s=>{if(!s.scheduledDate||s.status==="completed")return!1;const e=R(s.scheduledDate).diff(R(),"day");return e<=3&&e>0},ee=s=>!s.scheduledDate||s.status==="completed"?!1:s.status==="overdue"||R().isAfter(R(s.scheduledDate)),te=async s=>{q.value[s.id]=!0;try{await new Promise(e=>setTimeout(e,1e3)),T.success(`已向相关人员发送${s.name}的提醒通知`)}finally{q.value[s.id]=!1}},se=async s=>{F.value[s.id]=!0;try{await new Promise(e=>setTimeout(e,1e3)),T.success(`已向相关人员发送${s.name}的催办通知`)}finally{F.value[s.id]=!1}},ae=s=>{T.info(`下载材料：${s.name}`)},ne=(s,e)=>{M.value=s,X.value=e,w.value={reason:""},x.value=!0},oe=()=>{if(!w.value.reason.trim()){T.error("请填写打回原因");return}M.value&&(M.value.status="rejected",M.value.rejectReason=w.value.reason),T.success("材料已打回，相关人员将收到通知"),x.value=!1},le=()=>{x.value=!1};return me(()=>{const s=ve(),e=s.query.projectId;if(e){if(h.value.find(f=>f.id===e))p.value=e;else{const f={id:e,name:s.query.projectName||"Unknown Project",leader:s.query.applicant||"Unknown",type:s.query.projectType||"Unknown Type",status:"实施中",startDate:s.query.startDate||"2024-01-01",approvalDate:s.query.approvalDate||"2024-01-01"};h.value.unshift(f),p.value=e}B(p.value)}else h.value.length>0&&(p.value=h.value[0].id,B(p.value))}),(s,e)=>{const N=u("a-select-option"),f=u("a-select"),D=u("a-tag"),U=u("a-space"),r=u("a-card"),ie=u("a-progress"),P=u("a-button"),de=u("a-empty"),L=u("a-form-item"),re=u("a-textarea"),ue=u("a-form"),ce=u("a-modal");return o(),d("div",Me,[e[18]||(e[18]=t("div",{class:"page-header"},[t("h1",{class:"page-title"},"进度监控"),t("div",{class:"page-desc"},"基于时间维度监控项目实施进度，实时跟踪节点状态与材料提交")],-1)),t("div",Ne,[n(f,{value:p.value,"onUpdate:value":e[0]||(e[0]=a=>p.value=a),placeholder:"选择项目进行监控",style:{width:"280px"},onChange:B,size:"large"},{default:i(()=>[(o(!0),d(b,null,$(h.value,a=>(o(),C(N,{key:a.id,value:a.id},{default:i(()=>[t("div",Pe,[t("div",Oe,l(a.name),1),t("div",ze,l(a.leader)+" · "+l(a.startDate),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_.value?(o(),d("div",Te,[n(r,{class:"project-info-card",size:"small"},{default:i(()=>[t("div",Ue,[t("div",$e,[t("h3",null,l(_.value.name),1),n(U,null,{default:i(()=>[n(D,{color:"blue"},{default:i(()=>[y(l(_.value.type),1)]),_:1}),n(D,{color:"green"},{default:i(()=>[y(l(_.value.status),1)]),_:1})]),_:1})]),t("div",Re,[t("div",qe,[e[4]||(e[4]=t("div",{class:"stat-label"},"项目负责人",-1)),t("div",Fe,l(_.value.leader),1)]),t("div",Se,[e[5]||(e[5]=t("div",{class:"stat-label"},"立项时间",-1)),t("div",Ve,l(_.value.approvalDate),1)]),t("div",Be,[e[6]||(e[6]=t("div",{class:"stat-label"},"整体进度",-1)),t("div",Ie,l(V.value)+"%",1)])])])]),_:1}),n(r,{class:"progress-overview-card",size:"small"},{default:i(()=>[t("div",Le,[t("div",Xe,[e[7]||(e[7]=t("h4",null,"项目整体进度",-1)),t("div",Ye,[t("span",Ae,l(V.value)+"% 完成",1),t("span",Ee,l(I.value)+"/"+l(S.value)+" 节点",1)])]),n(ie,{percent:V.value,"stroke-color":{"0%":"#108ee9","100%":"#87d068"},"trail-color":"#f0f0f0","stroke-width":"8","show-info":!1},null,8,["percent"]),t("div",Ge,[(o(!0),d(b,null,$(A.value,(a,O)=>(o(),d("div",{class:"milestone-item",key:O},[t("div",{class:z(["milestone-dot",a.status])},null,2),t("div",Qe,[t("div",Je,l(a.name),1),t("div",We,l(a.date||"待定"),1)])]))),128))])])]),_:1}),n(r,{class:"timeline-card",title:"项目实施进度时间轴"},{default:i(()=>[t("div",Ze,[t("div",He,[(o(!0),d(b,null,$(Y.value,(a,O)=>(o(),d("div",{key:a.id,class:z(["timeline-item",G(a)])},[t("div",{class:z(["timeline-dot",Q(a)])},[(o(),C(_e(J(a))))],2),t("div",Ke,[t("div",et,[t("h4",null,l(a.name),1),t("div",{class:z(["node-status",a.status])},l(W(a.status)),3)]),t("div",tt,[a.scheduledDate?(o(),d(b,{key:0},[n(v(fe)),a.status==="completed"?(o(),d("span",st,"完成时间："+l(a.completedDate),1)):a.status==="overdue"?(o(),d("span",at,"截止时间："+l(a.scheduledDate)+" (已超期)",1)):(o(),d("span",nt,"截止时间："+l(a.scheduledDate),1))],64)):(o(),d(b,{key:1},[n(v(ye)),e[8]||(e[8]=t("span",{class:"pending-time"},"等待确定时间",-1))],64))]),t("div",ot,l(a.description),1),a.type==="submission"?(o(),d("div",lt,[t("div",it,[n(v(he)),e[9]||(e[9]=t("span",null,"提交材料",-1))]),a.materials&&a.materials.length?(o(),d("div",dt,[(o(!0),d(b,null,$(a.materials,c=>(o(),d("div",{key:c.id,class:z(["material-item",c.status])},[t("div",rt,[n(v(ke)),t("span",ut,l(c.name),1),n(D,{color:Z(c.status),size:"small"},{default:i(()=>[y(l(H(c.status)),1)]),_:2},1032,["color"])]),t("div",ct,[c.status!=="pending"?(o(),C(P,{key:0,type:"link",size:"small",onClick:pe=>ae(c)},{default:i(()=>[n(v(Ce)),e[10]||(e[10]=y(" 下载 ",-1))]),_:2,__:[10]},1032,["onClick"])):k("",!0),c.status==="submitted"?(o(),C(P,{key:1,type:"link",size:"small",danger:"",onClick:pe=>ne(c,a)},{default:i(()=>[n(v(we)),e[11]||(e[11]=y(" 打回 ",-1))]),_:2,__:[11]},1032,["onClick"])):k("",!0)])],2))),128))])):(o(),d("div",pt,[n(v(De)),e[12]||(e[12]=t("span",null,"暂无材料提交",-1))]))])):k("",!0),t("div",mt,[K(a)?(o(),C(P,{key:0,type:"primary",size:"small",onClick:c=>te(a),loading:q.value[a.id]},{default:i(()=>[n(v(je)),e[13]||(e[13]=y(" 提醒 ",-1))]),_:2,__:[13]},1032,["onClick","loading"])):k("",!0),ee(a)?(o(),C(P,{key:1,type:"primary",danger:"",size:"small",onClick:c=>se(a),loading:F.value[a.id]},{default:i(()=>[n(v(be)),e[14]||(e[14]=y(" 催办 ",-1))]),_:2,__:[14]},1032,["onClick","loading"])):k("",!0)])])],2))),128)),t("div",vt,[t("div",_t,[n(v(ge))]),t("div",gt,[e[15]||(e[15]=t("div",{class:"node-header"},[t("h4",null,"项目立项"),t("div",{class:"node-status completed"},"已完成")],-1)),t("div",ft,l(_.value.approvalDate),1),e[16]||(e[16]=t("div",{class:"node-desc"},"项目立项审批通过，正式启动",-1))])])])])]),_:1})])):k("",!0),p.value?k("",!0):(o(),C(de,{key:1,description:"请选择项目查看进度监控"},{default:i(()=>[n(P,{type:"primary",onClick:e[1]||(e[1]=a=>{var O;return p.value=(O=h.value[0])==null?void 0:O.id})},{default:i(()=>e[17]||(e[17]=[y(" 选择项目 ",-1)])),_:1,__:[17]})]),_:1})),n(ce,{open:x.value,"onUpdate:open":e[3]||(e[3]=a=>x.value=a),title:"材料打回",onOk:oe,onCancel:le},{default:i(()=>[n(ue,{model:w.value,"label-col":{span:6},"wrapper-col":{span:18}},{default:i(()=>[n(L,{label:"材料名称"},{default:i(()=>{var a;return[t("span",null,l((a=M.value)==null?void 0:a.name),1)]}),_:1}),n(L,{label:"打回原因",required:""},{default:i(()=>[n(re,{value:w.value.reason,"onUpdate:value":e[2]||(e[2]=a=>w.value.reason=a),rows:4,placeholder:"请详细说明材料不合格的原因"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}},Dt=xe(yt,[["__scopeId","data-v-3030296e"]]);export{Dt as default};
